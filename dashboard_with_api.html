<!DOCTYPE html>
<!--
üé≤ FIXED SEED VERSION üé≤
This dashboard now uses a seeded random number generator (seed: 1962 - Walmart's founding year!)
so that everyone who opens this file sees the EXACT SAME supplier data.

‚úÖ What's shared: All vendor data (names, locations, products, ratings, etc.)
‚ùå What's NOT shared: User-specific data (favorites, notes, inbox) - these are stored in browser localStorage

Created with ‚ù§Ô∏è by Code Puppy üê∂
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supplier Search Engine - Construction Materials & Products</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;800&family=Space+Grotesk:wght@500;700&family=Playfair+Display:wght@700;900&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        @keyframes slideInBottom {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideOutBottom {
            from {
                transform: translateY(0);
                opacity: 1;
            }
            to {
                transform: translateY(100px);
                opacity: 0;
            }
        }
        
        :root {
            --walmart-blue: #0071ce;
            --walmart-red: #e02020;
            --walmart-yellow: #ffc220;
            --walmart-dark-blue: #004c91;
            --light-bg: #f8f9fa;
            --border: #e0e0e0;
            --heading-font: 'Bebas Neue', 'Impact', sans-serif;
            --body-font: 'Inter', 'Helvetica Neue', sans-serif;
            --accent-font: 'Space Grotesk', 'Helvetica', sans-serif;
            --serif-font: 'Playfair Display', 'Georgia', serif;
        }

        body {
            font-family: var(--body-font);
            background: #ffffff;
            background-image: 
                linear-gradient(90deg, rgba(0, 113, 206, 0.03) 1px, transparent 1px),
                linear-gradient(rgba(0, 113, 206, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            font-size: 13px;
            line-height: 1.4;
            margin: 0;
            padding: 0;
        }

        .header {
            background: var(--walmart-blue);
            padding: 0;
            position: relative;
            overflow: visible;
            margin-bottom: 0;
        }

        .toolbar {
            background: #f5f5f5;
            border-bottom: 3px solid #ddd;
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 99;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 0;
        }

        .toolbar-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .toolbar-section {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .toolbar-btn {
            background: white;
            border: 2px solid #ddd;
            padding: 8px 16px;
            font-family: var(--accent-font);
            font-weight: 600;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.1);
        }

        .toolbar-btn:hover {
            background: var(--walmart-blue);
            color: white;
            border-color: var(--walmart-blue);
            transform: translate(-1px, -1px);
            box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.15);
        }

        .toolbar-btn .btn-icon {
            font-size: 1rem;
        }

        .toolbar-info {
            font-family: var(--body-font);
            font-size: 0.9rem;
            color: #666;
        }

        .toolbar-info strong {
            color: var(--walmart-blue);
            font-size: 1.1rem;
        }

        .view-switcher {
            display: flex;
            gap: 5px;
            background: white;
            padding: 3px;
            border: 2px solid #ddd;
        }

        .view-btn {
            background: white;
            border: none;
            padding: 6px 12px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: var(--accent-font);
            letter-spacing: 0.5px;
        }

        .view-btn:hover {
            background: #f0f8ff;
        }

        .view-btn.active {
            background: var(--walmart-blue);
            color: white;
        }

        /* Grid View Styles */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .results-grid .supplier-item {
            display: flex;
            flex-direction: column;
        }

        /* Catalog View Styles */
        .results-catalog {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .supplier-catalog-card {
            background: white;
            border: 3px solid var(--walmart-blue);
            padding: 0;
            transition: all 0.3s;
            position: relative;
        }

        .supplier-catalog-card:hover {
            transform: translateY(-5px);
            box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.2);
        }

        .catalog-header {
            background: var(--walmart-blue);
            color: white;
            padding: 20px;
            border-bottom: 3px solid var(--walmart-yellow);
        }

        .catalog-body {
            padding: 20px;
        }

        .catalog-name {
            font-family: var(--heading-font);
            font-size: 1.3rem;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .catalog-category {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .catalog-stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }

        .catalog-stat:last-child {
            border-bottom: none;
        }

        .catalog-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 10px 20px;
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            gap: 40px;
            position: relative;
            overflow: visible;
        }

        .header-title {
            text-align: center;
            font-family: var(--accent-font);
            font-size: 3rem;
            letter-spacing: 8px;
            color: white;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.2);
            white-space: nowrap;
            font-weight: 700;
            font-style: normal;
        }

        .header-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 8px;
            height: 100%;
            background: var(--walmart-yellow);
        }

        .user-menu {
            position: relative;
            z-index: 100000;
        }

        .user-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            font-family: var(--accent-font);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
        }

        .user-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: var(--walmart-yellow);
        }

        .user-dropdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 999999;
            display: none;
        }

        .user-dropdown-overlay.active {
            display: block;
        }

        .user-dropdown {
            position: fixed;
            background: white;
            border: 3px solid var(--walmart-blue);
            box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.3);
            min-width: 220px;
            z-index: 9999999;
            padding: 5px 0;
        }

        .dropdown-item {
            padding: 12px 20px;
            cursor: pointer;
            font-family: var(--body-font);
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .dropdown-item:hover {
            background: var(--walmart-blue);
            color: white;
        }

        .dropdown-divider {
            height: 2px;
            background: #ddd;
            margin: 5px 0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 10px;
        }



        .search-container {
            position: relative;
            flex: 1;
            max-width: 300px;
        }

        .search-box {
            width: 100%;
            padding: 6px 35px 6px 30px;
            font-size: 0.85rem;
            font-family: var(--body-font);
            font-weight: 500;
            border: 2px solid #ddd;
            transition: all 0.2s ease;
            background: white;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--walmart-blue);
        }

        .search-box::placeholder {
            color: #999;
            font-weight: 400;
            letter-spacing: 0.3px;
        }

        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 1rem;
            animation: searchPulse 2s ease-in-out infinite;
        }

        @keyframes searchPulse {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.1); }
        }

        .clear-search {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 0.9rem;
            display: none;
            padding: 3px;
            line-height: 1;
            transition: all 0.2s;
        }

        .clear-search:hover {
            color: var(--walmart-red);
            transform: translateY(-50%) rotate(90deg) scale(1.1);
        }

        .autocomplete {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-top: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }

        .autocomplete.active { display: block; }

        .autocomplete-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .autocomplete-item:hover {
            background: var(--light-bg);
        }

        .autocomplete-item .icon {
            color: #666;
        }

        .autocomplete-item .text {
            flex: 1;
        }

        .autocomplete-item .category {
            font-size: 0.85rem;
            color: #999;
        }

        .main-content {
            max-width: 1400px;
            margin: 20px auto 20px;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
        }

        .filters {
            background: linear-gradient(to bottom, #ffffff 0%, #f8f9fa 100%);
            border-radius: 12px;
            padding: 15px;
            max-height: calc(100vh - 110px);
            overflow-y: auto;
            overflow-x: hidden;
            position: sticky;
            top: 90px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 113, 206, 0.1);
        }

        .filters::-webkit-scrollbar {
            width: 8px;
        }

        .filters::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .filters::-webkit-scrollbar-thumb {
            background: var(--walmart-blue);
            border-radius: 4px;
        }

        .filters::-webkit-scrollbar-thumb:hover {
            background: var(--walmart-dark-blue);
        }

        .filters-header {
            padding: 20px;
            background: var(--walmart-blue);
            color: white;
            margin: -20px -20px 20px -20px;
            border-bottom: 4px solid var(--walmart-yellow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .collapse-all-btn {
            background: var(--walmart-yellow);
            color: #000;
            border: none;
            padding: 8px 16px;
            font-family: var(--accent-font);
            font-weight: 700;
            font-size: 0.75rem;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.2);
        }

        .collapse-all-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 rgba(0, 0, 0, 0.3);
        }

        .collapse-all-btn:active {
            transform: translate(0, 0);
            box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2);
        }

        .filter-section {
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        .filter-section:last-child {
            border-bottom: none;
        }

        .filter-title {
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--walmart-blue);
            font-size: 0.95rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
        }

        .filter-title:hover {
            color: var(--walmart-dark-blue);
        }

        .filter-title .collapse-icon {
            font-size: 0.8rem;
            transition: transform 0.3s;
        }

        .filter-content {
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .filter-content.collapsed {
            max-height: 0;
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
            cursor: pointer;
        }

        .filter-option input[type="checkbox"] {
            cursor: pointer;
        }

        .filter-option label {
            cursor: pointer;
            flex: 1;
            font-size: 0.85rem;
        }

        .filter-count {
            color: #999;
            font-size: 0.75rem;
        }

        .filter-expand {
            color: var(--walmart-blue);
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 8px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
        }

        .filter-expand:hover {
            text-decoration: underline;
        }

        .fixture-subcategory {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .fixture-subcategory-title {
            font-weight: 600;
            color: var(--walmart-blue);
            font-size: 0.85rem;
            margin-bottom: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .fixture-subcategory-title:hover {
            text-decoration: underline;
        }

        .fixture-products {
            margin-left: 12px;
            margin-top: 6px;
        }

        .fixture-products.collapsed {
            display: none;
        }

        .hidden-category {
            display: none;
        }

        .hidden-category.show {
            display: flex;
        }

        .vendor-search {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .vendor-search:focus {
            outline: none;
            border-color: var(--walmart-blue);
        }

        .vendor-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .vendor-list::-webkit-scrollbar {
            width: 6px;
        }

        .vendor-list::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .vendor-list::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        .walmart-tagline {
            background: var(--walmart-yellow);
            color: #000;
            padding: 8px 20px;
            text-align: center;
            font-family: var(--heading-font);
            font-weight: 900;
            font-size: 0.85rem;
            letter-spacing: 2px;
            text-shadow: none;
            border-bottom: 4px solid var(--walmart-blue);
            position: relative;
            margin: 0;
            border-top: none;
        }



        .results-area {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-box {
            background: var(--walmart-blue);
            color: white;
            padding: 15px 10px;
            text-align: center;
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            position: relative;
            border: 2px solid var(--walmart-dark-blue);
            clip-path: polygon(0 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%);
        }

        .stat-box::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 0 10px 10px;
            border-color: transparent transparent var(--walmart-yellow) transparent;
        }

        .stat-box.clickable {
            cursor: pointer;
        }

        .stat-box.clickable:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.15);
        }

        .stat-box.clickable:active {
            transform: translate(-1px, -1px);
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.1);
        }

        .stat-box.yellow {
            background: var(--walmart-yellow);
            color: #000;
            border-color: #e6a800;
        }

        .stat-box.yellow::after {
            border-color: transparent transparent var(--walmart-blue) transparent;
        }

        .stat-box.red {
            background: var(--walmart-red);
            border-color: #c01818;
        }

        .stat-box.red::after {
            border-color: transparent transparent var(--walmart-blue) transparent;
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 12px;
            filter: drop-shadow(2px 2px 0 rgba(0, 0, 0, 0.3));
        }

        .stat-box .number {
            font-family: var(--heading-font);
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 3px;
            letter-spacing: 1px;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2);
            line-height: 1;
        }

        .stat-box .label {
            font-family: var(--accent-font);
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
            gap: 20px;
            flex-wrap: wrap;
        }

        .results-info {
            font-size: 0.95rem;
            color: #666;
        }

        .sort-options select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .supplier-item {
            border: 2px solid transparent;
            background: linear-gradient(white, white) padding-box,
                        linear-gradient(135deg, var(--walmart-blue), var(--walmart-yellow)) border-box;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .supplier-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 113, 206, 0.1), transparent);
            transition: left 0.5s;
        }

        .supplier-item:hover::before {
            left: 100%;
        }

        .compare-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--walmart-blue);
            flex-shrink: 0;
        }

        .favorite-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            filter: grayscale(100%);
            opacity: 0.5;
        }

        .favorite-btn:hover {
            transform: scale(1.2);
            filter: grayscale(0%);
            opacity: 1;
        }

        .favorite-btn.favorited {
            filter: grayscale(0%);
            opacity: 1;
            animation: heartBeat 0.3s ease;
        }

        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.3); }
            50% { transform: scale(1.1); }
        }

        .note-btn {
            background: var(--walmart-yellow);
            border: 2px solid #e6a800;
            padding: 6px 12px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .note-btn:hover {
            background: #e6a800;
            transform: translate(-2px, -2px);
            box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.2);
        }

        .note-btn.has-note {
            background: var(--walmart-blue);
            border-color: var(--walmart-dark-blue);
        }

        .comparison-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .comparison-content {
            background: white;
            width: 100%;
            max-width: 1400px;
            max-height: 90vh;
            overflow-y: auto;
            border: 4px solid var(--walmart-blue);
            box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.3);
        }

        .comparison-header {
            background: var(--walmart-blue);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid var(--walmart-yellow);
        }

        .comparison-table-wrapper {
            overflow-x: auto;
            padding: 20px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            font-family: var(--body-font);
        }

        .comparison-table thead {
            background: #f5f5f5;
            border-bottom: 3px solid var(--walmart-blue);
        }

        .comparison-table th {
            padding: 15px;
            text-align: left;
            font-family: var(--heading-font);
            font-size: 1.1rem;
            letter-spacing: 1px;
            border-right: 2px solid #ddd;
        }

        .comparison-table th:first-child {
            background: var(--walmart-blue);
            color: white;
            position: sticky;
            left: 0;
            z-index: 10;
        }

        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            border-right: 2px solid #ddd;
        }

        .comparison-table td:first-child {
            background: #f9f9f9;
            font-weight: 600;
            position: sticky;
            left: 0;
            z-index: 9;
        }

        .comparison-table tbody tr:hover {
            background: #f0f8ff;
        }

        .score-cell {
            font-weight: 700;
            color: var(--walmart-blue);
            font-size: 1.1rem;
        }

        .supplier-item:hover {
            box-shadow: 0 12px 24px rgba(0, 113, 206, 0.25);
            transform: translateY(-3px);
            border-color: var(--walmart-blue);
        }

        .supplier-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .supplier-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--walmart-blue);
            cursor: pointer;
        }

        .supplier-name:hover {
            text-decoration: underline;
        }

        .supplier-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 12px;
            font-size: 0.9rem;
            color: #666;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .supplier-products {
            margin: 12px 0;
        }

        .product-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .tag {
            background: #e7f3ff;
            color: var(--walmart-blue);
            padding: 6px 12px;
            border: 2px solid transparent;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-block;
        }

        .tag:hover {
            background: var(--walmart-blue);
            color: white;
            border-color: var(--walmart-dark-blue);
            transform: translate(-2px, -2px);
            box-shadow: 3px 3px 0 rgba(0, 113, 206, 0.3);
        }

        .tag:active {
            transform: translate(0, 0);
            box-shadow: 1px 1px 0 rgba(0, 113, 206, 0.3);
        }

        .tag.featured {
            background: var(--walmart-yellow);
            color: #000;
            font-weight: 700;
            border-color: #e6a800;
        }

        .tag.featured:hover {
            background: #e6a800;
            border-color: #cc9600;
        }

        .supplier-certifications {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .cert-badge {
            background: #d4edda;
            color: #155724;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .page-btn {
            padding: 8px 15px;
            border: 1px solid var(--border);
            background: white;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .page-btn:hover:not(:disabled) {
            background: var(--walmart-blue);
            color: white;
            border-color: var(--walmart-blue);
        }

        .page-btn.active {
            background: var(--walmart-blue);
            color: white;
            border-color: var(--walmart-blue);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .ai-score {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: linear-gradient(135deg, var(--walmart-blue) 0%, var(--walmart-dark-blue) 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .walmart-verified {
            background: var(--walmart-red);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--walmart-blue) 0%, var(--walmart-dark-blue) 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 12px 12px 0 0;
            position: relative;
        }

        .modal-header h2 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .modal-header .subtitle {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-close:focus {
            outline: 3px solid var(--walmart-yellow);
            outline-offset: 2px;
        }

        .modal-body {
            padding: 30px;
        }

        .modal-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .modal-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .modal-section h3 {
            color: var(--walmart-blue);
            margin-bottom: 12px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .info-label {
            font-weight: 600;
            color: #666;
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        .info-value {
            font-size: 1rem;
            color: #333;
        }

        .contact-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .contact-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .contact-btn.primary {
            background: var(--walmart-blue);
            color: white;
        }

        .contact-btn.primary:hover {
            background: var(--walmart-dark-blue);
            transform: translateY(-2px);
        }

        .contact-btn.secondary {
            background: white;
            color: var(--walmart-blue);
            border: 2px solid var(--walmart-blue);
        }

        .contact-btn.secondary:hover {
            background: var(--walmart-blue);
            color: white;
        }

        .description-text {
            line-height: 1.6;
            color: #555;
        }

        .stat-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: var(--light-bg);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--walmart-blue);
        }

        .stat-card .label {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .filters {
                position: static;
            }
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="walmart-tagline">
        SAVE MONEY. LIVE BETTER. FIND BETTER SUPPLIERS.
    </div>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div style="background: var(--walmart-yellow); width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border: 3px solid var(--walmart-blue); font-size: 1.5rem; font-weight: 900;">W</div>
                <div>
                    <div style="font-family: var(--heading-font); font-size: 1.8rem; font-weight: 900; letter-spacing: 1px; line-height: 0.9;">WALMART</div>
                    <div style="font-family: var(--accent-font); font-size: 0.65rem; font-weight: 600; letter-spacing: 3px; margin-top: 2px;">VENDOR DISCOVERY</div>
                </div>
            </div>
            <div class="header-title">SUPPLIER HUB</div>
            <div class="user-menu" id="userMenu" style="justify-self: end;">
                <button class="user-btn" onclick="toggleUserDropdown(event)" id="userMenuBtn">
                    <span id="userName">Guest</span>
                    <span style="font-size: 0.7rem;">‚ñº</span>
                </button>
            </div>
        </div>
    </header>

    <nav class="toolbar">
        <div class="toolbar-content">
            <div class="toolbar-section">
                <button class="toolbar-btn" onclick="window.location.reload()">
                    <span>HOME</span>
                </button>
                <button class="toolbar-btn" onclick="window.location.href='help.html'">
                    <span>üìñ HELP</span>
                </button>
                <button class="toolbar-btn" onclick="exportResults()">
                    <span>EXPORT</span>
                </button>
                <button class="toolbar-btn" onclick="printResults()">
                    <span>PRINT</span>
                </button>
            </div>
            <div class="toolbar-section">
                <button class="toolbar-btn" onclick="clearAllFilters()">
                    <span class="btn-icon">RESET</span>
                </button>
                <button class="toolbar-btn" onclick="toggleCompareMode()">
                    <span id="compareBtnText">COMPARE (0)</span>
                </button>
            </div>
            <div class="toolbar-section">
                <span class="toolbar-info">
                    <strong id="toolbarResultCount">0</strong> suppliers found
                </span>
                <span class="toolbar-info" id="spStatus" style="margin-left: 15px; font-size: 0.75rem; opacity: 0.8;">
                    üîÑ Connecting...
                </span>
            </div>
        </div>
    </nav>

    <div class="main-content">
        <aside class="filters">
            <div class="filters-header">
                <h3 style="font-family: var(--heading-font); font-size: 1.5rem; letter-spacing: 2px; margin: 0;">FILTERS</h3>
                <button id="collapseAllBtn" class="collapse-all-btn" onclick="toggleAllFilters()">
                    <span id="collapseAllText">COLLAPSE ALL</span>
                </button>
            </div>
            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('vendorSection')">
                    <span>Vendors</span>
                    <span class="collapse-icon" id="vendorSection-icon">‚ñ≤</span>
                </div>
                <div class="filter-content collapsed" id="vendorSection">
                    <input type="text" class="vendor-search" id="vendorSearch" placeholder="Search vendors..." aria-label="Search vendors">
                    <div class="vendor-list" id="vendorFilters"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('categorySection')">
                    <span>Material Category</span>
                    <span class="collapse-icon" id="categorySection-icon">‚ñ≤</span>
                </div>
                <div class="filter-content collapsed" id="categorySection">
                    <div id="categoryFilters"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('productSection')">
                    <span>Product Type</span>
                    <span class="collapse-icon" id="productSection-icon">‚ñ≤</span>
                </div>
                <div class="filter-content collapsed" id="productSection">
                    <div id="productTypeFilters"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('fixtureSection')">
                    <span>Fixtures & Hardware</span>
                    <span class="collapse-icon" id="fixtureSection-icon">‚ñ≤</span>
                </div>
                <div class="filter-content collapsed" id="fixtureSection">
                    <div id="fixtureFilters"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('regionSection')">
                    <span>Region</span>
                    <span class="collapse-icon" id="regionSection-icon">‚ñ≤</span>
                </div>
                <div class="filter-content collapsed" id="regionSection">
                    <div id="regionFilters"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('certSection')">
                    <span>Certifications</span>
                    <span class="collapse-icon" id="certSection-icon">‚ñ≤</span>
                </div>
                <div class="filter-content collapsed" id="certSection">
                    <div id="certFilters"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('sizeSection')">
                    <span>Company Size</span>
                    <span class="collapse-icon" id="sizeSection-icon">‚ñ≤</span>
                </div>
                <div class="filter-content collapsed" id="sizeSection">
                    <div id="sizeFilters"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('priceSection')">
                    <span>Price Range</span>
                    <span class="collapse-icon" id="priceSection-icon">‚ñ≤</span>
                </div>
                <div class="filter-content collapsed" id="priceSection">
                    <div id="priceFilters"></div>
                </div>
            </div>
        </aside>

        <main class="results-area" role="main">
                <div class="stats-dashboard">
                    <div class="stat-box clickable" onclick="filterByStat('all')" title="Click to reset and show all suppliers">
                        <div class="number" id="totalSuppliersCount">0</div>
                        <div class="label">Total Suppliers</div>
                    </div>
                    <div class="stat-box yellow clickable" onclick="filterByStat('categories')" title="Click to sort vendors by category">
                        <div class="number" id="categoriesCount">0</div>
                        <div class="label">Categories</div>
                    </div>
                    <div class="stat-box red clickable" onclick="filterByStat('products')" title="Click to sort vendors by number of products">
                        <div class="number" id="productsCount">0</div>
                        <div class="label">Products Available</div>
                    </div>
                    <div class="stat-box clickable" onclick="filterByStat('verified')" title="Click to show only Walmart Verified suppliers">
                        <div class="number" id="verifiedCount">0</div>
                        <div class="label">Walmart Verified</div>
                    </div>
                </div>

                <div class="results-header">
                <div class="results-info">
                    <span id="resultsCount">0</span> suppliers found
                </div>
                <div class="search-container">
                    <span class="search-icon">‚åï</span>
                    <input 
                        type="text" 
                        class="search-box" 
                        id="searchInput"
                        placeholder="Search suppliers, products, brands, SKUs..."
                        aria-label="Search suppliers and products"
                        autocomplete="off"
                    >
                    <button class="clear-search" id="clearSearch" aria-label="Clear search">‚úï</button>
                    <div class="autocomplete" id="autocomplete"></div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="view-switcher">
                        <button class="view-btn active" id="viewList" onclick="switchView('list')" title="List view">
                            LIST
                        </button>
                        <button class="view-btn" id="viewGrid" onclick="switchView('grid')" title="Grid view">
                            GRID
                        </button>
                        <button class="view-btn" id="viewCatalog" onclick="switchView('catalog')" title="Catalog view">
                            CATALOG
                        </button>
                    </div>
                    <div class="sort-options">
                        <select id="sortSelect" aria-label="Sort results">
                            <option value="relevance">Most Relevant</option>
                            <option value="score-high">AI Score: High to Low</option>
                            <option value="score-low">AI Score: Low to High</option>
                            <option value="name-asc">Name: A to Z</option>
                            <option value="name-desc">Name: Z to A</option>
                            <option value="rating">Customer Rating</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="resultsContainer"></div>

            <div class="pagination" id="pagination"></div>
        </main>
    </div>

    <div class="modal" id="supplierModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle"></h2>
                <div class="subtitle" id="modalSubtitle"></div>
                <button class="modal-close" id="modalClose" aria-label="Close modal">‚úï</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>

// API URL - point to the backend API server
const API_URL = window.location.origin; // Uses current domain (works on localhost and production)
let USE_API = true; // Set to true to use API instead of local generation
let allSuppliers = []; // Initialize empty array, will be filled from API
let filteredSuppliers = []; // Filtered results
let currentPage = 1;
const itemsPerPage = 12;
let currentView = 'grid'; // or 'catalog'
let compareList = []; // List of supplier IDs selected for comparison
let compareMode = false; // Whether we're in compare mode
let favoritesList = []; // List of favorite supplier IDs

// Function to load suppliers from API
// DEPRECATED: These functions are no longer used
// The new initializeFromServer() handles all data loading
// Keeping them here for reference only - they are NOT called

/*
async function loadSuppliersFromAPI(skip = 0, limit = 5000) {
    try {
        const response = await fetch(`${API_URL}/api/dashboard/suppliers?skip=${skip}&limit=${limit}`);
        if (!response.ok) throw new Error('API Error');
        const data = await response.json();
        return data.suppliers || [];
    } catch (error) {
        console.warn('API load failed, using local generation:', error);
        USE_API = false;
        return null;
    }
}

// Function to load dashboard stats from API
async function loadStatsFromAPI() {
    try {
        const response = await fetch(`${API_URL}/api/dashboard/stats`);
        if (!response.ok) throw new Error('API Error');
        const data = await response.json();
        return data;
    } catch (error) {
        console.warn('API stats load failed:', error);
        return null;
    }
}

// Function to search suppliers from API
async function searchSuppliersFromAPI(query) {
    try {
        const response = await fetch(`${API_URL}/api/dashboard/suppliers/search?q=${encodeURIComponent(query)}`);
        if (!response.ok) throw new Error('API Error');
        const data = await response.json();
        return data.results || [];
    } catch (error) {
        console.warn('API search failed:', error);
        return null;
    }
}

// Initialize dashboard - DEPRECATED, use initializeFromServer() instead
async function initializeDashboard() {
    console.log('‚è≥ Loading suppliers from', API_URL, '...');
    
    try {
        // Try to load from API
        const suppliers = await loadSuppliersFromAPI();
        
        if (suppliers && suppliers.length > 0) {
            allSuppliers = suppliers;
            filteredSuppliers = [...allSuppliers];
            console.log('‚úÖ Loaded', allSuppliers.length, 'suppliers from API');
            
            // Initialize filters and display
            populateFilters();
            renderResults();
            updateStats();
            
            // Show success message
            document.getElementById('spStatus').innerHTML = '‚òÅÔ∏è API Connected';
        } else {
            throw new Error('No suppliers returned from API');
        }
    } catch (error) {
        console.error('‚ùå Failed to load from API:', error);
        document.getElementById('spStatus').innerHTML = '‚ö†Ô∏è API Error - Check server';
        
        // Show error message to user
        const container = document.getElementById('resultsContainer');
        if (container) {
            container.innerHTML = `
                <div style="grid-column: 1/-1; padding: 40px; text-align: center; background: #fff3cd; border-radius: 8px; color: #856404;">
                    <h3>‚ö†Ô∏è Cannot Connect to Server</h3>
                    <p>The API server at <strong>${API_URL}</strong> is not responding.</p>
                    <p>Make sure the backend and data servers are running:</p>
                    <pre style="background: white; padding: 15px; border-radius: 4px; text-align: left; display: inline-block;">
# Terminal 1:
cd data-server && node server.js

# Terminal 2:
cd backend && node server.js
                    </pre>
                    <p style="margin-top: 15px; font-size: 0.9rem;">Error: ${error.message}</p>
                </div>
            `;
        }
    }
}

// Placeholder functions - will be properly implemented later
function populateFilters() {
    // This will populate filter UI
    console.log('Filters populated for', allSuppliers.length, 'suppliers');
}

function renderResults() {
    // This will render the supplier results
    console.log('Results rendered');
}

function updateStats() {
    // This will update statistics
    console.log('Stats updated');
}

// Forward declare productCategories - will be assigned later
let productCategories = {};

        // Comprehensive product catalog
        productCategories = {
            'Concrete & Cement': ['Ready-Mix Concrete', 'Precast Concrete', 'Concrete Blocks', 'Portland Cement', 'Concrete Admixtures', 'Fiber-Reinforced Concrete', 'Self-Leveling Concrete', 'Decorative Concrete'],
            'Steel & Metal': ['Structural Steel', 'Rebar', 'Steel Beams', 'Metal Studs', 'Sheet Metal', 'Galvanized Steel', 'Aluminum', 'Copper Piping', 'Steel Decking'],
            'Lumber & Wood': ['Dimensional Lumber', 'Plywood', 'OSB Panels', 'Engineered Wood', 'Treated Lumber', 'Hardwood Flooring', 'Laminated Beams', 'Wood Trusses'],
            'Roofing Materials': ['Asphalt Shingles', 'Metal Roofing', 'TPO Membrane', 'EPDM Roofing', 'Tile Roofing', 'Underlayment', 'Flashing', 'Roof Coatings'],
            'Insulation': ['Fiberglass Batts', 'Spray Foam', 'Rigid Foam Board', 'Mineral Wool', 'Cellulose Insulation', 'Reflective Insulation', 'Acoustic Insulation'],
            'Drywall & Gypsum': ['Standard Drywall', 'Moisture-Resistant Drywall', 'Fire-Rated Drywall', 'Ceiling Tiles', 'Joint Compound', 'Drywall Tape'],
            'Electrical': ['Wire & Cable', 'Conduit', 'Junction Boxes', 'Breaker Panels', 'LED Fixtures', 'Switches & Outlets', 'Cable Trays', 'Emergency Lighting'],
            'Plumbing': ['PVC Pipe', 'Copper Pipe', 'PEX Tubing', 'Valves & Fittings', 'Water Heaters', 'Fixtures', 'Drain Systems', 'Backflow Preventers'],
            'HVAC': ['Air Handling Units', 'Ductwork', 'Thermostats', 'Refrigerant', 'Air Filters', 'Ventilation Fans', 'Heat Pumps', 'Boilers'],
            'Flooring': ['Vinyl Flooring', 'Ceramic Tile', 'Carpet', 'Hardwood', 'Laminate', 'Epoxy Coatings', 'Polished Concrete', 'Rubber Flooring'],
            'Windows & Doors': ['Vinyl Windows', 'Aluminum Windows', 'Steel Doors', 'Wood Doors', 'Fiberglass Doors', 'Sliding Glass Doors', 'French Doors', 'Garage Doors', 'Storm Doors'],
            'Door Hardware & Fixtures': ['Door Handles', 'Door Knobs', 'Deadbolts', 'Door Closers', 'Hinges', 'Door Stops', 'Panic Hardware', 'Access Control Systems', 'Automatic Door Openers'],
            'Lighting Fixtures': ['LED Downlights', 'Chandeliers', 'Pendant Lights', 'Track Lighting', 'Wall Sconces', 'Outdoor Lighting', 'Emergency Exit Lights', 'Motion Sensor Lights'],
            'Plumbing Fixtures': ['Toilets', 'Sinks', 'Faucets', 'Shower Heads', 'Bathtubs', 'Urinals', 'Drinking Fountains', 'Floor Drains', 'Grab Bars'],
            'Kitchen & Bath Fixtures': ['Kitchen Sinks', 'Kitchen Faucets', 'Garbage Disposals', 'Range Hoods', 'Bathroom Vanities', 'Medicine Cabinets', 'Towel Bars', 'Soap Dispensers'],
            'Safety & Security Fixtures': ['Smoke Detectors', 'Carbon Monoxide Detectors', 'Fire Extinguishers', 'Fire Alarms', 'Security Cameras', 'Motion Sensors', 'Emergency Lighting', 'Exit Signs', 'Safety Railings', 'Bollards', 'Security Gates', 'Card Readers', 'Keypad Entry Systems'],
            'Vinyl Products': ['Vinyl Siding', 'Vinyl Trim', 'Vinyl Soffit', 'Vinyl Fencing', 'Vinyl Flooring', 'Vinyl Window Frames', 'Vinyl Railings'],
            'HVAC Fixtures': ['Air Vents', 'Registers', 'Grilles', 'Diffusers', 'Return Air Grilles', 'HVAC Dampers', 'Ceiling Fans', 'Exhaust Fans'],
            'Temporary Construction Equipment': ['Temporary Walls', 'Temporary Partitions', 'Construction Fencing', 'Crowd Barriers', 'Jersey Barriers', 'Safety Barricades', 'Temporary Gates', 'Dust Barriers', 'Wind Screens'],
            'Personal Protective Equipment': ['Hard Hats', 'Safety Glasses', 'Face Shields', 'Respirators', 'Dust Masks', 'Work Gloves', 'Safety Vests', 'Fall Protection Harnesses', 'Ear Protection', 'Steel Toe Boots', 'Knee Pads', 'Hi-Vis Clothing'],
            'Cart & Transport Equipment': ['Shopping Carts', 'Material Carts', 'Platform Carts', 'Hand Trucks', 'Dollies', 'Pallet Jacks', 'Cart Wheels', 'Cart Parts', 'Utility Carts', 'Laundry Carts', 'Waste Collection Carts'],
            'Scaffolding & Ladders': ['Frame Scaffolding', 'Rolling Scaffolding', 'Extension Ladders', 'Step Ladders', 'Platform Ladders', 'Scaffold Planks', 'Scaffold Accessories', 'Ladder Safety Cages'],
            'Signage & Wayfinding': ['ADA Signs', 'Exit Signs', 'Directional Signs', 'Parking Signs', 'Safety Signs', 'Floor Graphics', 'Digital Displays', 'Post & Panel Signs', 'Monument Signs'],
            'Material Handling Equipment': ['Forklifts', 'Pallet Racks', 'Conveyor Systems', 'Hoists', 'Cranes', 'Lifting Slings', 'Chain Hoists', 'Dock Levelers', 'Wheel Chocks'],
            'Concrete Forms & Accessories': ['Wall Forms', 'Column Forms', 'Slab Forms', 'Form Ties', 'Form Release Agents', 'Snap Ties', 'Walers', 'Concrete Screeds'],
            'Site Furnishings': ['Benches', 'Picnic Tables', 'Bike Racks', 'Trash Receptacles', 'Ash Urns', 'Planters', 'Bollards', 'Flagpoles'],
            'Janitorial & Maintenance': ['Floor Cleaners', 'Mops & Buckets', 'Cleaning Chemicals', 'Trash Bags', 'Paper Products', 'Sanitizers', 'Floor Machines', 'Pressure Washers'],
            'Landscape & Site Work': ['Mulch', 'Topsoil', 'Gravel', 'Landscape Fabric', 'Drainage Pipes', 'Irrigation Systems', 'Retaining Walls', 'Geotextiles'],
            'Acoustic & Soundproofing': ['Acoustic Panels', 'Soundproofing Insulation', 'Acoustic Ceiling Tiles', 'Mass Loaded Vinyl', 'Sound Barriers', 'Acoustic Doors', 'Acoustic Sealants'],
            'Fire Protection Systems': ['Sprinkler Heads', 'Fire Hoses', 'Fire Pumps', 'Fire Hydrants', 'Standpipe Systems', 'Fire Dampers', 'Fire Rated Doors', 'Fire Suppression Systems'],
            'Loading Dock Equipment': ['Dock Levelers', 'Dock Bumpers', 'Dock Seals', 'Dock Shelters', 'Dock Lights', 'Wheel Guides', 'Vehicle Restraints', 'Dock Plates'],
            'Masonry': ['Brick', 'Concrete Block', 'Mortar', 'Stone Veneer', 'Retaining Wall Systems', 'Pavers', 'Grout'],
            'Paint & Coatings': ['Interior Paint', 'Exterior Paint', 'Primers', 'Epoxy Coatings', 'Stains & Sealers', 'Waterproofing', 'Fire-Retardant Coatings', 'Traffic Marking Paint'],
            'Fasteners & Hardware': ['Screws', 'Nails', 'Bolts & Anchors', 'Brackets', 'Hinges', 'Clips', 'Straps', 'Washers', 'Nuts'],
            'Shelving & Storage': ['Wire Shelving', 'Heavy Duty Shelving', 'Garage Storage', 'Closet Organizers', 'Tool Storage', 'Cabinets', 'Lockers', 'Storage Bins'],
            'Tools & Equipment': ['Power Tools', 'Hand Tools', 'Measuring Tools', 'Cutting Tools', 'Tool Belts', 'Tool Boxes', 'Generators', 'Air Compressors'],
            'Adhesives & Sealants': ['Construction Adhesive', 'Silicone Sealant', 'Caulk', 'Epoxy', 'Wood Glue', 'Concrete Bonding Agents', 'Spray Adhesives', 'Tapes'],
            'Retail Fixtures & Displays': ['Gondola Shelving', 'End Caps', 'Display Tables', 'Slatwall Panels', 'Grid Walls', 'Mannequins', 'Clothing Racks', 'Pegboard Displays', 'Glass Display Cases'],
            'Checkout & POS Equipment': ['Checkout Counters', 'Conveyor Belts', 'Bagging Stations', 'Card Readers', 'Cash Drawers', 'Receipt Printers', 'Self-Checkout Kiosks', 'Scanner Scales'],
            'Commercial Refrigeration': ['Walk-In Coolers', 'Walk-In Freezers', 'Refrigerated Display Cases', 'Reach-In Refrigerators', 'Ice Machines', 'Refrigeration Condensers', 'Evaporator Coils', 'Glass Door Merchandisers'],
            'Commercial Kitchen Equipment': ['Commercial Ovens', 'Fryers', 'Griddles', 'Deli Slicers', 'Food Warmers', 'Prep Tables', 'Commercial Sinks', 'Bakery Ovens', 'Mixers'],
            'Parking Lot & Site Equipment': ['Parking Lot Striping', 'Light Poles', 'Cart Corrals', 'Asphalt Sealant', 'Parking Bollards', 'Speed Bumps', 'Wheel Stops', 'Parking Signs', 'Pavement Markings'],
            'Commercial Flooring Systems': ['Polished Concrete', 'VCT Tile', 'Anti-Fatigue Mats', 'Commercial Carpet Tile', 'Epoxy Floor Coatings', 'Floor Leveling Compound', 'Transition Strips', 'Walk-Off Mats'],
            'Ceiling Systems': ['Drop Ceiling Grid', 'Acoustic Ceiling Tiles', 'Metal Ceiling Panels', 'Suspended Ceiling Hangers', 'Ceiling Insulation', 'Ceiling Access Panels'],
            'Commercial Overhead Doors': ['Sectional Overhead Doors', 'Rolling Steel Doors', 'High-Speed Doors', 'Dock Doors', 'Fire Doors', 'Door Operators', 'Loading Dock Seals'],
            'Commercial Lighting Systems': ['High Bay LED Fixtures', 'Retail Track Lighting', 'Parking Lot Lights', 'Emergency Backup Lighting', 'Lighting Controls', 'Occupancy Sensors', 'Warehouse Lighting'],
            'Loss Prevention Equipment': ['EAS Security Tags', 'Security Pedestals', 'CCTV Cameras', 'DVR Systems', 'Security Mirrors', 'Locking Showcases', 'Anti-Theft Devices'],
            'Building Automation & Controls': ['HVAC Controls', 'Energy Management Systems', 'Building Management Software', 'Programmable Thermostats', 'Automated Lighting Controls', 'Access Control Systems'],
            'Emergency Power Systems': ['Backup Generators', 'UPS Systems', 'Transfer Switches', 'Fuel Tanks', 'Battery Backup Systems', 'Emergency Lighting Inverters'],
            'Commercial Plumbing Systems': ['Grease Traps', 'Backflow Preventers', 'Commercial Water Heaters', 'Floor Drains', 'Mop Sinks', 'Pre-Rinse Spray Valves', 'Hydrants'],
            'Commercial Roofing Systems': ['TPO Roofing Membrane', 'EPDM Rubber Roofing', 'Metal Roof Panels', 'Roof Insulation', 'Roof Drains', 'Flashing Systems', 'Parapet Caps'],
            'Department-Specific Fixtures': ['Pharmacy Counters', 'Bakery Display Cases', 'Deli Cases', 'Meat Cases', 'Produce Racks', 'Garden Center Shelving', 'Apparel Fixtures', 'Electronics Security Cases'],
            'Auto Service Equipment': ['Tire Changers', 'Wheel Balancers', 'Automotive Lifts', 'Oil Drain Systems', 'Air Compressors', 'Battery Chargers', 'Diagnostic Equipment'],
            'Waste Management Systems': ['Compactors', 'Balers', 'Dumpsters', 'Recycling Bins', 'Waste Containers', 'Cardboard Balers', 'Grease Containers'],
            'Wall Systems & Partitions': ['Metal Stud Framing', 'Demountable Partitions', 'Bathroom Partitions', 'Modular Walls', 'FRP Panels', 'Wall Protection', 'Corner Guards']
        };

        const regions = ['Northeast', 'Southeast', 'Midwest', 'Southwest', 'West', 'National'];
        const certifications = ['ISO 9001', 'LEED', 'MBE', 'WBE', 'OSHA Certified', 'Energy Star Partner'];
        const companySizes = ['Small (1-50)', 'Medium (51-500)', 'Large (500+)'];
        const priceRanges = ['Budget ($)', 'Standard ($$)', 'Premium ($$$)', 'Enterprise ($$$$)'];

        // üé≤ Seeded Random Number Generator (Mulberry32)
        // Using seed 1962 (Walmart founded in 1962!) so everyone sees the same "random" data
        function createSeededRandom(seed = 1962) {
            return function() {
                let t = seed += 0x6D2B79F5;
                t = Math.imul(t ^ t >>> 15, t | 1);
                t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            }
        }
        
        const seededRandom = createSeededRandom(1962); // Fixed seed for consistent data!

        // ==========================================
        // üóÑÔ∏è SHAREPOINT BACKEND INTEGRATION
        // ==========================================
        
        const SHAREPOINT_CONFIG = {
            siteUrl: 'https://walmart.sharepoint.com/sites/SupplierPortal',
            lists: {
                userProfiles: 'UserProfiles',
                favorites: 'SupplierFavorites',
                notes: 'SupplierNotes',
                inbox: 'SupplierInbox'
            },
            enabled: false, // ‚ö†Ô∏è SET TO TRUE after creating SharePoint lists! (See SHAREPOINT-SETUP-GUIDE.html)
            useLocalStorageFallback: true // Use localStorage if SharePoint fails
        };
        
        // Initialize SharePoint service now that config is defined
        setTimeout(() => initSharePointService(), 100);

        /* 
        üìã SHAREPOINT SETUP INSTRUCTIONS:
        
        Create these 4 lists in your SharePoint site (https://walmart.sharepoint.com/sites/SupplierPortal):
        
        1. UserProfiles
           - Title (Single line of text) - User email
           - FullName (Single line of text)
           - Department (Single line of text)
           - LastLogin (Date and Time)
        
        2. SupplierFavorites
           - Title (Single line of text) - User email
           - SupplierId (Number)
           - DateAdded (Date and Time)
        
        3. SupplierNotes
           - Title (Single line of text) - User email
           - SupplierId (Number)
           - NoteText (Multiple lines of text)
           - DateCreated (Date and Time)
           - DateModified (Date and Time)
        
        4. SupplierInbox
           - Title (Single line of text) - User email
           - MessageId (Number)
           - Vendor (Single line of text)
           - Subject (Single line of text)
           - Message (Multiple lines of text)
           - DateReceived (Date and Time)
           - IsRead (Yes/No)
           - IsStarred (Yes/No)
        */

        // SharePoint Service Class
        class SharePointService {
            constructor(config) {
                this.config = config;
                this.digestValue = null;
                this.currentUserEmail = null;
            }

            async init() {
                if (!this.config.enabled) return false;
                
                try {
                    // Add a 5-second timeout for SharePoint connection
                    const timeoutPromise = new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('SharePoint connection timeout (5s)')), 5000)
                    );
                    
                    // Race between the init and timeout
                    const initPromise = this.getCurrentUser();
                    await Promise.race([initPromise, timeoutPromise]);
                    return true;
                } catch (error) {
                    console.warn('SharePoint init failed, using localStorage fallback:', error.message || error);
                    return false;
                }
            }

            async getCurrentUser() {
                try {
                    const controller = new AbortController();
                    const timeout = setTimeout(() => controller.abort(), 3000); // 3 second timeout
                    
                    const response = await fetch(`${this.config.siteUrl}/_api/web/currentuser`, {
                        headers: {
                            'Accept': 'application/json;odata=verbose'
                        },
                        credentials: 'include',
                        signal: controller.signal
                    });
                    clearTimeout(timeout);
                    
                    if (response.ok) {
                        const data = await response.json();
                        this.currentUserEmail = data.d.Email;
                        return this.currentUserEmail;
                    }
                } catch (error) {
                    console.warn('Could not get current user from SharePoint:', error);
                }
                return null;
            }

            async getRequestDigest() {
                if (this.digestValue) return this.digestValue;
                
                try {
                    const response = await fetch(`${this.config.siteUrl}/_api/contextinfo`, {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/json;odata=verbose'
                        },
                        credentials: 'include'
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        this.digestValue = data.d.GetContextWebInformation.FormDigestValue;
                        return this.digestValue;
                    }
                } catch (error) {
                    console.warn('Could not get request digest:', error);
                }
                return null;
            }

            async getUserProfile(email) {
                try {
                    const response = await fetch(
                        `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.userProfiles}')/items?$filter=Title eq '${email}'`,
                        {
                            headers: {
                                'Accept': 'application/json;odata=verbose'
                            },
                            credentials: 'include'
                        }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.d.results.length > 0) {
                            return data.d.results[0];
                        }
                    }
                } catch (error) {
                    console.warn('Error getting user profile:', error);
                }
                return null;
            }

            async createUserProfile(email, fullName, department) {
                const digest = await this.getRequestDigest();
                if (!digest) return null;
                
                try {
                    const response = await fetch(
                        `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.userProfiles}')/items`,
                        {
                            method: 'POST',
                            headers: {
                                'Accept': 'application/json;odata=verbose',
                                'Content-Type': 'application/json;odata=verbose',
                                'X-RequestDigest': digest
                            },
                            credentials: 'include',
                            body: JSON.stringify({
                                __metadata: { type: 'SP.Data.UserProfilesListItem' },
                                Title: email,
                                FullName: fullName,
                                Department: department,
                                LastLogin: new Date().toISOString()
                            })
                        }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        return data.d;
                    }
                } catch (error) {
                    console.warn('Error creating user profile:', error);
                }
                return null;
            }

            async getFavorites(email) {
                try {
                    const response = await fetch(
                        `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.favorites}')/items?$filter=Title eq '${email}'`,
                        {
                            headers: {
                                'Accept': 'application/json;odata=verbose'
                            },
                            credentials: 'include'
                        }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        return data.d.results.map(item => item.SupplierId);
                    }
                } catch (error) {
                    console.warn('Error getting favorites:', error);
                }
                return [];
            }

            async addFavorite(email, supplierId) {
                const digest = await this.getRequestDigest();
                if (!digest) return false;
                
                try {
                    const response = await fetch(
                        `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.favorites}')/items`,
                        {
                            method: 'POST',
                            headers: {
                                'Accept': 'application/json;odata=verbose',
                                'Content-Type': 'application/json;odata=verbose',
                                'X-RequestDigest': digest
                            },
                            credentials: 'include',
                            body: JSON.stringify({
                                __metadata: { type: 'SP.Data.SupplierFavoritesListItem' },
                                Title: email,
                                SupplierId: supplierId,
                                DateAdded: new Date().toISOString()
                            })
                        }
                    );
                    
                    return response.ok;
                } catch (error) {
                    console.warn('Error adding favorite:', error);
                }
                return false;
            }

            async removeFavorite(email, supplierId) {
                const digest = await this.getRequestDigest();
                if (!digest) return false;
                
                try {
                    // First, get the item ID
                    const getResponse = await fetch(
                        `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.favorites}')/items?$filter=Title eq '${email}' and SupplierId eq ${supplierId}`,
                        {
                            headers: {
                                'Accept': 'application/json;odata=verbose'
                            },
                            credentials: 'include'
                        }
                    );
                    
                    if (getResponse.ok) {
                        const data = await getResponse.json();
                        if (data.d.results.length > 0) {
                            const itemId = data.d.results[0].Id;
                            
                            // Delete the item
                            const deleteResponse = await fetch(
                                `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.favorites}')/items(${itemId})`,
                                {
                                    method: 'DELETE',
                                    headers: {
                                        'Accept': 'application/json;odata=verbose',
                                        'X-RequestDigest': digest,
                                        'IF-MATCH': '*'
                                    },
                                    credentials: 'include'
                                }
                            );
                            
                            return deleteResponse.ok;
                        }
                    }
                } catch (error) {
                    console.warn('Error removing favorite:', error);
                }
                return false;
            }

            async getNotes(email) {
                try {
                    const response = await fetch(
                        `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.notes}')/items?$filter=Title eq '${email}'`,
                        {
                            headers: {
                                'Accept': 'application/json;odata=verbose'
                            },
                            credentials: 'include'
                        }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        const notes = {};
                        data.d.results.forEach(item => {
                            notes[item.SupplierId] = item.NoteText;
                        });
                        return notes;
                    }
                } catch (error) {
                    console.warn('Error getting notes:', error);
                }
                return {};
            }

            async saveNote(email, supplierId, noteText) {
                const digest = await this.getRequestDigest();
                if (!digest) return false;
                
                try {
                    // Check if note exists
                    const getResponse = await fetch(
                        `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.notes}')/items?$filter=Title eq '${email}' and SupplierId eq ${supplierId}`,
                        {
                            headers: {
                                'Accept': 'application/json;odata=verbose'
                            },
                            credentials: 'include'
                        }
                    );
                    
                    if (getResponse.ok) {
                        const data = await getResponse.json();
                        
                        if (data.d.results.length > 0) {
                            // Update existing note
                            const itemId = data.d.results[0].Id;
                            const updateResponse = await fetch(
                                `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.notes}')/items(${itemId})`,
                                {
                                    method: 'POST',
                                    headers: {
                                        'Accept': 'application/json;odata=verbose',
                                        'Content-Type': 'application/json;odata=verbose',
                                        'X-RequestDigest': digest,
                                        'IF-MATCH': '*',
                                        'X-HTTP-Method': 'MERGE'
                                    },
                                    credentials: 'include',
                                    body: JSON.stringify({
                                        __metadata: { type: 'SP.Data.SupplierNotesListItem' },
                                        NoteText: noteText,
                                        DateModified: new Date().toISOString()
                                    })
                                }
                            );
                            return updateResponse.ok;
                        } else {
                            // Create new note
                            const createResponse = await fetch(
                                `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.notes}')/items`,
                                {
                                    method: 'POST',
                                    headers: {
                                        'Accept': 'application/json;odata=verbose',
                                        'Content-Type': 'application/json;odata=verbose',
                                        'X-RequestDigest': digest
                                    },
                                    credentials: 'include',
                                    body: JSON.stringify({
                                        __metadata: { type: 'SP.Data.SupplierNotesListItem' },
                                        Title: email,
                                        SupplierId: supplierId,
                                        NoteText: noteText,
                                        DateCreated: new Date().toISOString(),
                                        DateModified: new Date().toISOString()
                                    })
                                }
                            );
                            return createResponse.ok;
                        }
                    }
                } catch (error) {
                    console.warn('Error saving note:', error);
                }
                return false;
            }
        }

        // Initialize SharePoint service (will be set up after SHAREPOINT_CONFIG is defined)
        let spService = null;
        let useSharePoint = false;
        
        // Initialize spService - will be called after SHAREPOINT_CONFIG is available
        function initSharePointService() {
            try {
                if (typeof SHAREPOINT_CONFIG !== 'undefined' && typeof SharePointService !== 'undefined') {
                    spService = new SharePointService(SHAREPOINT_CONFIG);
                    console.log('‚úÖ SharePoint service initialized');
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Failed to initialize SharePoint service:', error);
                spService = null;
            }
        }

        // Storage abstraction layer - uses SharePoint or localStorage
        const storage = {
            async getUser(email) {
                if (useSharePoint && spService) {
                    const profile = await spService.getUserProfile(email);
                    if (profile) {
                        const favorites = await spService.getFavorites(email);
                        const notes = await spService.getNotes(email);
                        return {
                            name: profile.FullName,
                            email: email,
                            department: profile.Department,
                            favorites: favorites,
                            notes: notes,
                            inbox: [] // Inbox would be loaded separately
                        };
                    }
                    return null;
                } else {
                    const users = JSON.parse(localStorage.getItem('supplierPortalUsers') || '{}');
                    return users[email] || null;
                }
            },
            
            async saveUser(email, userData) {
                if (useSharePoint) {
                    // User profile is managed separately in SharePoint
                    return true;
                } else {
                    const users = JSON.parse(localStorage.getItem('supplierPortalUsers') || '{}');
                    users[email] = userData;
                    localStorage.setItem('supplierPortalUsers', JSON.stringify(users));
                    return true;
                }
            },
            
            async getFavorites(email) {
                if (useSharePoint && spService) {
                    return await spService.getFavorites(email);
                } else {
                    const users = JSON.parse(localStorage.getItem('supplierPortalUsers') || '{}');
                    return users[email]?.favorites || [];
                }
            },
            
            async addFavorite(email, supplierId) {
                if (useSharePoint && spService) {
                    return await spService.addFavorite(email, supplierId);
                } else {
                    const users = JSON.parse(localStorage.getItem('supplierPortalUsers') || '{}');
                    if (!users[email]) return false;
                    if (!users[email].favorites) users[email].favorites = [];
                    if (!users[email].favorites.includes(supplierId)) {
                        users[email].favorites.push(supplierId);
                    }
                    localStorage.setItem('supplierPortalUsers', JSON.stringify(users));
                    return true;
                }
            },
            
            async removeFavorite(email, supplierId) {
                if (useSharePoint && spService) {
                    return await spService.removeFavorite(email, supplierId);
                } else {
                    const users = JSON.parse(localStorage.getItem('supplierPortalUsers') || '{}');
                    if (!users[email]) return false;
                    if (users[email].favorites) {
                        users[email].favorites = users[email].favorites.filter(id => id !== supplierId);
                    }
                    localStorage.setItem('supplierPortalUsers', JSON.stringify(users));
                    return true;
                }
            },
            
            async getNotes(email) {
                if (useSharePoint && spService) {
                    return await spService.getNotes(email);
                } else {
                    const users = JSON.parse(localStorage.getItem('supplierPortalUsers') || '{}');
                    return users[email]?.notes || {};
                }
            },
            
            async saveNote(email, supplierId, noteText) {
                if (useSharePoint && spService) {
                    return await spService.saveNote(email, supplierId, noteText);
                } else {
                    const users = JSON.parse(localStorage.getItem('supplierPortalUsers') || '{}');
                    if (!users[email]) return false;
                    if (!users[email].notes) users[email].notes = {};
                    users[email].notes[supplierId] = noteText;
                    localStorage.setItem('supplierPortalUsers', JSON.stringify(users));
                    return true;
                }
            }
        };

        // ‚ö†Ô∏è LOCAL DATA GENERATION DISABLED - Using server data only
        // All supplier data is now fetched from /api/suppliers endpoint

        // ‚úÖ LOAD SUPPLIERS FROM SERVER ONLY (no local generation)
        // NOTE: allSuppliers already declared at line 1641, just reassign
        filteredSuppliers = [];
        
        // First, ensure userData is initialized before loading suppliers
        async function ensureUserDataInitialized() {
            if (userData) return; // Already initialized
            console.log('Ensuring userData is initialized...');
            
            let userEmail = localStorage.getItem('currentUser');
            if (!userEmail) {
                userEmail = 'guest@supplier-portal.local';
                localStorage.setItem('currentUser', userEmail);
            }
            
            currentUser = userEmail;
            userData = {
                email: userEmail,
                name: 'Guest User',
                role: 'viewer',
                favorites: [],
                notes: {},
                preferences: {}
            };
            console.log('‚úÖ userData initialized:', userData);
        }
        
        // Initialize on page load
        async function initializeFromServer() {
            console.log('üöÄ Loading suppliers from server...');
            
            // FIRST: Ensure userData exists
            await ensureUserDataInitialized();
            
            try {
                console.log('Fetching from:', window.location.origin + '/api/suppliers');
                const response = await fetch(window.location.origin + '/api/suppliers');
                console.log('Response status:', response.status);
                if (!response.ok) throw new Error('Server error: ' + response.status);
                const data = await response.json();
                console.log('Response data:', data);
                allSuppliers = data.data || [];
                filteredSuppliers = [...allSuppliers];
                console.log('‚úÖ Loaded', allSuppliers.length, 'suppliers from server');
                
                // Call rendering functions with error handling
                try {
                    console.log('Initializing filters...');
                    if (typeof initializeFilters === 'function') {
                        initializeFilters();
                        console.log('‚úÖ Filters initialized');
                    }
                } catch (e) {
                    console.error('‚ùå Error in initializeFilters:', e);
                }
                
                try {
                    console.log('Updating stats...');
                    if (typeof updateStats === 'function') {
                        updateStats();
                        console.log('‚úÖ Stats updated');
                    }
                } catch (e) {
                    console.error('‚ùå Error in updateStats:', e);
                }
                
                try {
                    console.log('Rendering results...');
                    if (typeof renderResults === 'function') {
                        renderResults();
                        console.log('‚úÖ Results rendered');
                    }
                } catch (e) {
                    console.error('‚ùå Error in renderResults:', e);
                }
                
                try {
                    console.log('Rendering pagination...');
                    if (typeof renderPagination === 'function') {
                        renderPagination();
                        console.log('‚úÖ Pagination rendered');
                    }
                } catch (e) {
                    console.error('‚ùå Error in renderPagination:', e);
                }
                
                console.log('‚úÖ Dashboard initialization complete!');
            } catch (error) {
                console.error('‚ùå Failed to load suppliers:', error);
                console.error('Stack trace:', error.stack);
                alert('‚ùå Failed to load from server:\n' + error.message);
            }
        }
        
        // Call on DOMContentLoaded
        console.log('Page ready state:', document.readyState);
        if (document.readyState === 'loading') {
            console.log('Waiting for DOMContentLoaded...');
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOMContentLoaded fired');
                initializeFromServer();
            });
        } else {
            console.log('DOM already loaded, initializing now...');
            initializeFromServer();
        }
        
        // Also call on window load to be extra sure
        window.addEventListener('load', function() {
            console.log('Window load event fired, suppliers loaded:', allSuppliers.length);
            if (allSuppliers.length === 0) {
                console.log('No suppliers yet, retrying initialization...');
                initializeFromServer();
            }
        });
        // NOTE: currentPage and itemsPerPage already declared at line 1643
        // Do NOT redeclare - just use the existing variables

        // Toggle filter section collapse
        function toggleFilterSection(sectionId) {
            const section = document.getElementById(sectionId);
            const icon = document.getElementById(sectionId + '-icon');
            
            if (section.classList.contains('collapsed')) {
                section.classList.remove('collapsed');
                icon.textContent = '‚ñº';
            } else {
                section.classList.add('collapsed');
                icon.textContent = '‚ñ≤';
            }
        }

        let allCollapsed = false;
        function toggleAllFilters() {
            const sections = document.querySelectorAll('.filter-content');
            const icons = document.querySelectorAll('.collapse-icon');
            const btnText = document.getElementById('collapseAllText');
            
            allCollapsed = !allCollapsed;
            
            sections.forEach(section => {
                if (allCollapsed) {
                    section.classList.add('collapsed');
                } else {
                    section.classList.remove('collapsed');
                }
            });
            
            icons.forEach(icon => {
                icon.textContent = allCollapsed ? '‚ñ≤' : '‚ñº';
            });
            
            btnText.textContent = allCollapsed ? 'EXPAND ALL' : 'COLLAPSE ALL';
        }

        function filterByStat(type) {
            // Clear existing filters
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.getElementById('searchInput').value = '';
            
            if (type === 'all') {
                // Show all suppliers
                filteredSuppliers = [...allSuppliers];
                currentPage = 1;
                renderResults();
            } else if (type === 'verified') {
                // Filter to only verified suppliers
                filteredSuppliers = allSuppliers.filter(s => s.walmartVerified);
                currentPage = 1;
                renderResults();
                
                // Show notification
                showNotification(`‚úÖ Showing ${filteredSuppliers.length} Walmart Verified suppliers`);
            } else if (type === 'categories') {
                // Sort by category (alphabetically), then by name
                filteredSuppliers = [...allSuppliers].sort((a, b) => {
                    if (a.category < b.category) return -1;
                    if (a.category > b.category) return 1;
                    return a.name.localeCompare(b.name);
                });
                currentPage = 1;
                renderResults();
                
                // Show notification
                showNotification(`üìä Sorted by ${Object.keys(productCategories).length} categories`);
            } else if (type === 'products') {
                // Sort by number of products (most to least)
                filteredSuppliers = [...allSuppliers].sort((a, b) => b.products.length - a.products.length);
                currentPage = 1;
                renderResults();
                
                // Show notification
                showNotification(`üì¶ Sorted by product count (${filteredSuppliers[0].products.length} max)`);
            }
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showNotification(message) {
            // Remove existing notification if any
            const existing = document.getElementById('filterNotification');
            if (existing) existing.remove();
            
            // Create notification
            const notification = document.createElement('div');
            notification.id = 'filterNotification';
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: var(--walmart-blue);
                color: white;
                padding: 15px 25px;
                border: 3px solid var(--walmart-yellow);
                box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.2);
                z-index: 9999;
                font-family: var(--accent-font);
                font-weight: 600;
                font-size: 0.9rem;
                letter-spacing: 0.5px;
                animation: slideInBottom 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutBottom 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // NOTE: compareMode, compareList, and currentView already declared in main variables section
        // No need to redeclare them here!
        
        function toggleCompareMode() {
            if (compareList.length < 2) {
                alert('‚ö†Ô∏è Please select at least 2 suppliers to compare!');
                return;
            }
            showComparisonView();
        }

        function toggleCompareSupplier(supplierId) {
            try {
                console.log('toggleCompareSupplier called for:', supplierId);
                const checkbox = document.getElementById(`compare-${supplierId}`);
                
                if (!checkbox) {
                    console.error('Checkbox not found for supplier:', supplierId);
                    return;
                }
                
                if (checkbox.checked) {
                    if (compareList.length >= 5) {
                        checkbox.checked = false;
                        alert('‚ö†Ô∏è You can compare up to 5 suppliers at once.');
                        return;
                    }
                    compareList.push(supplierId);
                    console.log('‚úÖ Added to compare list:', supplierId);
                } else {
                    compareList = compareList.filter(id => id !== supplierId);
                    console.log('‚úÖ Removed from compare list:', supplierId);
                }
                
                updateCompareBtnText();
            } catch (error) {
                console.error('‚ùå Error toggling compare:', error);
            }
        }

        function updateCompareBtnText() {
            const btn = document.getElementById('compareBtnText');
            btn.textContent = `COMPARE (${compareList.length})`;
            
            // Enable/disable compare button
            const compareBtn = btn.parentElement;
            if (compareList.length >= 2) {
                compareBtn.style.background = 'var(--walmart-blue)';
                compareBtn.style.color = 'white';
                compareBtn.style.borderColor = 'var(--walmart-blue)';
            } else {
                compareBtn.style.background = 'white';
                compareBtn.style.color = '#666';
                compareBtn.style.borderColor = '#ddd';
            }
        }

        function showComparisonView() {
            const suppliers = compareList.map(id => allSuppliers.find(s => s.id === id));
            
            const comparisonHTML = `
                <div class="comparison-modal" id="comparisonModal">
                    <div class="comparison-content">
                        <div class="comparison-header">
                            <h2 style="font-family: var(--heading-font); font-size: 2rem; letter-spacing: 2px;">‚öñÔ∏è SUPPLIER COMPARISON</h2>
                            <button onclick="closeComparison()" class="modal-close">‚úï</button>
                        </div>
                        <div class="comparison-table-wrapper">
                            <table class="comparison-table">
                                <thead>
                                    <tr>
                                        <th>METRIC</th>
                                        ${suppliers.map(s => `<th>${s.name}</th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>AI Score</strong></td>
                                        ${suppliers.map(s => `<td class="score-cell">ü§ñ ${s.aiScore}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Rating</strong></td>
                                        ${suppliers.map(s => `<td>‚≠ê ${s.rating}/5.0</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Location</strong></td>
                                        ${suppliers.map(s => `<td>üìç ${s.location}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Company Size</strong></td>
                                        ${suppliers.map(s => `<td>üè¢ ${s.size}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Years in Business</strong></td>
                                        ${suppliers.map(s => `<td>üìÖ ${s.yearsInBusiness} years</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Employees</strong></td>
                                        ${suppliers.map(s => `<td>üë• ${s.employees}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Response Time</strong></td>
                                        ${suppliers.map(s => `<td>‚è±Ô∏è ${s.responseTime}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Min Order</strong></td>
                                        ${suppliers.map(s => `<td>üíµ ${s.minOrder}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Payment Terms</strong></td>
                                        ${suppliers.map(s => `<td>üí≥ ${s.paymentTerms}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Walmart Verified</strong></td>
                                        ${suppliers.map(s => `<td>${s.walmartVerified ? '‚úÖ Yes' : '‚ùå No'}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Products</strong></td>
                                        ${suppliers.map(s => `<td><small>${s.products.join(', ')}</small></td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Certifications</strong></td>
                                        ${suppliers.map(s => `<td><small>${s.certifications.join(', ')}</small></td>`).join('')}
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', comparisonHTML);
        }

        function closeComparison() {
            const modal = document.getElementById('comparisonModal');
            if (modal) modal.remove();
        }

        function switchView(view) {
            currentView = view;
            
            // Update button states
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`view${view.charAt(0).toUpperCase() + view.slice(1)}`).classList.add('active');
            
            // Re-render with new view
            renderResults();
        }

        function exportResults() {
            const csvContent = "data:text/csv;charset=utf-8,"
                + "Name,Location,Category,Rating,AI Score,Products,Verified\n"
                + filteredSuppliers.map(s => 
                    `"${s.name}","${s.location}","${s.category}",${s.rating},${s.aiScore},${s.products.length},${s.walmartVerified}`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "walmart_suppliers.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function printResults() {
            window.print();
        }

        function clearAllFilters() {
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.getElementById('searchInput').value = '';
            document.getElementById('sortSelect').value = 'relevance';
            applyFilters();
        }

        function filterByTag(productName) {
            // Clear existing filters
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            // Check the matching product checkbox if it exists
            const productCheckboxes = document.querySelectorAll('#productTypeFilters input[type="checkbox"]');
            productCheckboxes.forEach(cb => {
                if (cb.value === productName) {
                    cb.checked = true;
                }
            });
            
            // Also set search to the product name
            document.getElementById('searchInput').value = productName;
            
            // Apply filters
            applyFilters();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function closeModal() {
            document.getElementById('supplierModal').style.display = 'none';
        }

        // Initialize filters
        function initializeFilters() {
            try {
                // Vendors - show top 20 unique vendor names
                const vendorContainer = document.getElementById('vendorFilters');
            const uniqueVendors = [...new Set(allSuppliers.map(s => s.name))]
                .sort()
                .slice(0, 50); // Show first 50 vendors
            
            let allVendors = uniqueVendors;
            
            function renderVendors(vendors) {
                vendorContainer.innerHTML = vendors.map(vendor => {
                    const count = allSuppliers.filter(s => s.name === vendor).length;
                    return `
                        <div class="filter-option">
                            <input type="checkbox" id="vendor-${vendor.replace(/[^a-zA-Z0-9]/g, '')}" value="${vendor}" class="vendor-filter">
                            <label for="vendor-${vendor.replace(/[^a-zA-Z0-9]/g, '')}">${vendor}</label>
                            <span class="filter-count">(${count})</span>
                        </div>
                    `;
                }).join('');
                
                // Re-attach event listeners
                document.querySelectorAll('.vendor-filter').forEach(cb => {
                    cb.addEventListener('change', applyFilters);
                });
            }
            
            renderVendors(allVendors);
            
            // Vendor search functionality
            document.getElementById('vendorSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                if (searchTerm) {
                    const filtered = uniqueVendors.filter(v => v.toLowerCase().includes(searchTerm));
                    renderVendors(filtered);
                } else {
                    renderVendors(allVendors);
                }
            });
            // Categories - show first 10, rest hidden
            const categoryContainer = document.getElementById('categoryFilters');
            const allCategories = Object.keys(productCategories);
            const initialCategoryCount = 10;
            
            allCategories.forEach((cat, index) => {
                const count = allSuppliers.filter(s => s.category === cat).length;
                const isHidden = index >= initialCategoryCount;
                categoryContainer.innerHTML += `
                    <div class="filter-option ${isHidden ? 'hidden-category' : ''}">
                        <input type="checkbox" id="cat-${cat}" value="${cat}" class="category-filter">
                        <label for="cat-${cat}">${cat}</label>
                        <span class="filter-count">(${count})</span>
                    </div>
                `;
            });
            
            if (allCategories.length > initialCategoryCount) {
                categoryContainer.innerHTML += `
                    <div class="filter-expand" onclick="toggleCategories()" id="categoryToggle">
                        <span id="categoryToggleIcon">‚ñº</span> Show More (${allCategories.length - initialCategoryCount} more)
                    </div>
                `;
            }

            // Product Types - show top products from general categories
            const productContainer = document.getElementById('productTypeFilters');
            const generalCategories = ['Concrete & Cement', 'Steel & Metal', 'Lumber & Wood', 'Roofing Materials', 'Insulation'];
            const generalProducts = [];
            generalCategories.forEach(cat => {
                if (productCategories[cat]) {
                    generalProducts.push(...productCategories[cat].slice(0, 3));
                }
            });
            generalProducts.forEach(prod => {
                const count = allSuppliers.filter(s => s.products.includes(prod)).length;
                if (count > 0) {
                    productContainer.innerHTML += `
                        <div class="filter-option">
                            <input type="checkbox" id="prod-${prod}" value="${prod}" class="product-filter">
                            <label for="prod-${prod}">${prod}</label>
                            <span class="filter-count">(${count})</span>
                        </div>
                    `;
                }
            });

            // Fixtures & Hardware - organized by subcategory
            const fixtureContainer = document.getElementById('fixtureFilters');
            const fixtureCategories = {
                'Temporary Construction': productCategories['Temporary Construction Equipment'] || [],
                'PPE & Safety Gear': productCategories['Personal Protective Equipment'] || [],
                'Carts & Transport': productCategories['Cart & Transport Equipment'] || [],
                'Security Fixtures': productCategories['Safety & Security Fixtures'] || [],
                'Door Fixtures': productCategories['Door Hardware & Fixtures'] || [],
                'Lighting Fixtures': productCategories['Lighting Fixtures'] || [],
                'Plumbing Fixtures': productCategories['Plumbing Fixtures'] || [],
                'Kitchen & Bath': productCategories['Kitchen & Bath Fixtures'] || [],
                'Vinyl Products': productCategories['Vinyl Products'] || [],
                'HVAC Fixtures': productCategories['HVAC Fixtures'] || [],
                'Signage': productCategories['Signage & Wayfinding'] || [],
                'Material Handling': productCategories['Material Handling Equipment'] || [],
                'Scaffolding & Ladders': productCategories['Scaffolding & Ladders'] || [],
                'Site Furnishings': productCategories['Site Furnishings'] || [],
                'Fire Protection': productCategories['Fire Protection Systems'] || [],
                'Loading Dock': productCategories['Loading Dock Equipment'] || [],
                'Acoustic & Sound': productCategories['Acoustic & Soundproofing'] || [],
                'Concrete Forms': productCategories['Concrete Forms & Accessories'] || [],
                'Janitorial': productCategories['Janitorial & Maintenance'] || [],
                'Tools & Equipment': productCategories['Tools & Equipment'] || [],
                'Adhesives & Sealants': productCategories['Adhesives & Sealants'] || []
            };

            Object.entries(fixtureCategories).forEach(([subcat, products], index) => {
                if (products.length > 0) {
                    const subcatId = subcat.replace(/[^a-zA-Z0-9]/g, '');
                    const isExpanded = index < 2; // First 2 expanded by default
                    
                    fixtureContainer.innerHTML += `
                        <div class="fixture-subcategory">
                            <div class="fixture-subcategory-title" onclick="toggleFixtureCategory('${subcatId}')">
                                <span id="icon-${subcatId}">${isExpanded ? '‚ñº' : '‚ñ∂'}</span>
                                ${subcat}
                            </div>
                            <div class="fixture-products ${isExpanded ? '' : 'collapsed'}" id="${subcatId}">
                                ${products.map(prod => {
                                    const count = allSuppliers.filter(s => s.products.includes(prod)).length;
                                    return count > 0 ? `
                                        <div class="filter-option">
                                            <input type="checkbox" id="fixture-${prod}" value="${prod}" class="product-filter fixture-filter">
                                            <label for="fixture-${prod}">${prod}</label>
                                            <span class="filter-count">(${count})</span>
                                        </div>
                                    ` : '';
                                }).join('')}
                            </div>
                        </div>
                    `;
                }
            });

            // Regions
            const regionContainer = document.getElementById('regionFilters');
            regions.forEach(reg => {
                const count = allSuppliers.filter(s => s.region === reg).length;
                regionContainer.innerHTML += `
                    <div class="filter-option">
                        <input type="checkbox" id="reg-${reg}" value="${reg}" class="region-filter">
                        <label for="reg-${reg}">${reg}</label>
                        <span class="filter-count">(${count})</span>
                    </div>
                `;
            });

            // Certifications
            const certContainer = document.getElementById('certFilters');
            certifications.forEach(cert => {
                const count = allSuppliers.filter(s => s.certifications.includes(cert)).length;
                certContainer.innerHTML += `
                    <div class="filter-option">
                        <input type="checkbox" id="cert-${cert}" value="${cert}" class="cert-filter">
                        <label for="cert-${cert}">${cert}</label>
                        <span class="filter-count">(${count})</span>
                    </div>
                `;
            });

            // Company Size
            const sizeContainer = document.getElementById('sizeFilters');
            companySizes.forEach(size => {
                const count = allSuppliers.filter(s => s.size === size).length;
                sizeContainer.innerHTML += `
                    <div class="filter-option">
                        <input type="checkbox" id="size-${size}" value="${size}" class="size-filter">
                        <label for="size-${size}">${size}</label>
                        <span class="filter-count">(${count})</span>
                    </div>
                `;
            });

            // Price Range
            const priceContainer = document.getElementById('priceFilters');
            priceRanges.forEach(price => {
                const count = allSuppliers.filter(s => s.priceRange === price).length;
                priceContainer.innerHTML += `
                    <div class="filter-option">
                        <input type="checkbox" id="price-${price}" value="${price}" class="price-filter">
                        <label for="price-${price}">${price}</label>
                        <span class="filter-count">(${count})</span>
                    </div>
                `;
            });

            // Add event listeners
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', applyFilters);
            });
        }

        // Apply filters
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const selectedVendors = Array.from(document.querySelectorAll('.vendor-filter:checked')).map(cb => cb.value);
            const selectedCategories = Array.from(document.querySelectorAll('.category-filter:checked')).map(cb => cb.value);
            const selectedProducts = Array.from(document.querySelectorAll('.product-filter:checked')).map(cb => cb.value);
            const selectedRegions = Array.from(document.querySelectorAll('.region-filter:checked')).map(cb => cb.value);
            const selectedCerts = Array.from(document.querySelectorAll('.cert-filter:checked')).map(cb => cb.value);
            const selectedSizes = Array.from(document.querySelectorAll('.size-filter:checked')).map(cb => cb.value);
            const selectedPrices = Array.from(document.querySelectorAll('.price-filter:checked')).map(cb => cb.value);

            filteredSuppliers = allSuppliers.filter(supplier => {
                const matchesSearch = !searchTerm || 
                    supplier.name.toLowerCase().includes(searchTerm) ||
                    supplier.category.toLowerCase().includes(searchTerm) ||
                    supplier.products.some(p => p.toLowerCase().includes(searchTerm)) ||
                    supplier.location.toLowerCase().includes(searchTerm);

                const matchesVendor = selectedVendors.length === 0 || selectedVendors.includes(supplier.name);
                const matchesCategory = selectedCategories.length === 0 || selectedCategories.includes(supplier.category);
                const matchesProduct = selectedProducts.length === 0 || supplier.products.some(p => selectedProducts.includes(p));
                const matchesRegion = selectedRegions.length === 0 || selectedRegions.includes(supplier.region);
                const matchesCert = selectedCerts.length === 0 || supplier.certifications.some(c => selectedCerts.includes(c));
                const matchesSize = selectedSizes.length === 0 || selectedSizes.includes(supplier.size);
                const matchesPrice = selectedPrices.length === 0 || selectedPrices.includes(supplier.priceRange);

                return matchesSearch && matchesVendor && matchesCategory && matchesProduct && matchesRegion && matchesCert && matchesSize && matchesPrice;
            });

            currentPage = 1;
            renderResults();
            } catch (error) {
                console.error('‚ùå Error in initializeFilters:', error);
                // Continue without filters - they're not critical
            }
        }

        // Render catalog card
        function renderCatalogCard(supplier) {
            const isFavorited = userData && userData.favorites && userData.favorites.includes(supplier.id);
            const hasNote = userData && userData.notes && userData.notes[supplier.id];
            
            return `
                <div class="supplier-catalog-card">
                    <div class="catalog-header">
                        <div class="catalog-name">${supplier.name}</div>
                        <div class="catalog-category">${supplier.category}</div>
                    </div>
                    <div class="catalog-body">
                        <div class="catalog-stat">
                            <span>AI Score</span>
                            <strong>${supplier.aiScore}</strong>
                        </div>
                        <div class="catalog-stat">
                            <span>Rating</span>
                            <strong>${supplier.rating}/5.0</strong>
                        </div>
                        <div class="catalog-stat">
                            <span>Location</span>
                            <strong>${supplier.city}, ${supplier.state}</strong>
                        </div>
                        <div class="catalog-stat">
                            <span>Products</span>
                            <strong>${supplier.products.length}</strong>
                        </div>
                        <div class="catalog-stat">
                            <span>Years</span>
                            <strong>${supplier.yearsInBusiness}</strong>
                        </div>
                        ${supplier.walmartVerified ? '<div class="catalog-stat"><span>Verified</span><strong>Yes</strong></div>' : ''}
                        <div class="catalog-actions">
                            <button class="favorite-btn ${isFavorited ? 'favorited' : ''}" onclick="toggleFavorite(${supplier.id})" id="fav-${supplier.id}" style="font-size: 1.5rem; flex: 1;">
                                ‚ù§Ô∏è
                            </button>
                            <button class="note-btn ${hasNote ? 'has-note' : ''}" onclick="openNoteModal(${supplier.id})" style="flex: 2;">
                                NOTES
                            </button>
                            <button class="btn btn-primary" onclick="openSupplierModal(${supplier.id})" style="flex: 3; padding: 10px; font-size: 0.8rem;">
                                VIEW
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Render results
        function renderResults() {
            try {
                const container = document.getElementById('resultsContainer');
                if (!container) {
                    console.error('Results container not found');
                    return;
                }
                
                const start = (currentPage - 1) * itemsPerPage;
                const end = start + itemsPerPage;
                const pageSuppliers = filteredSuppliers.slice(start, end);

                document.getElementById('resultsCount').textContent = filteredSuppliers.length.toLocaleString();
                document.getElementById('toolbarResultCount').textContent = filteredSuppliers.length.toLocaleString();

            // Apply view-specific class to container
            container.className = currentView === 'grid' ? 'results-grid' : currentView === 'catalog' ? 'results-catalog' : '';

            if (currentView === 'catalog') {
                container.innerHTML = pageSuppliers.map(supplier => renderCatalogCard(supplier)).join('');
            } else {
                container.innerHTML = pageSuppliers.map(supplier => `
                <div class="supplier-item">
                    <div class="supplier-header">
                        <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                            <input type="checkbox" 
                                class="compare-checkbox" 
                                id="compare-${supplier.id}" 
                                onchange="toggleCompareSupplier(${supplier.id})" 
                                ${compareList.includes(supplier.id) ? 'checked' : ''}
                                title="Select for comparison">
                            <button class="favorite-btn" onclick="toggleFavorite(${supplier.id})" id="fav-${supplier.id}" title="Add to favorites">
                                ‚ù§Ô∏è
                            </button>
                            <div class="supplier-name" onclick="openSupplierModal(${supplier.id})" style="cursor: pointer;">
                                ${supplier.name}
                                ${supplier.walmartVerified ? '<span class="walmart-verified">‚úì Walmart Verified</span>' : ''}
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <button class="note-btn" onclick="openNoteModal(${supplier.id})" title="Add/view notes">
                                NOTE
                            </button>
                            <span class="ai-score">Stock: ${supplier.stockLevel}</span>
                        </div>
                    </div>
                    <div class="supplier-meta">
                        <span class="meta-item">${supplier.location}</span>
                        <span class="meta-item">Rating: ${supplier.rating}/5.0 (${supplier.reviews} reviews)</span>
                        <span class="meta-item">Stock: ${supplier.inStock ? 'Available' : 'Out of Stock'}</span>
                        <span class="meta-item">Lead time: ${supplier.leadTime}</span>
                        <span class="meta-item">Response: ${supplier.responseTime}</span>
                    </div>
                    <div class="supplier-products">
                        <strong>Products:</strong>
                        <div class="product-tags">
                            ${supplier.products.map((p, i) => `<span class="tag ${i === 0 ? 'featured' : ''}" onclick="filterByTag('${p.replace(/'/g, "\\'")}')" title="Click to filter by ${p}" style="cursor: pointer;">${p}</span>`).join('')}
                        </div>
                    </div>
                    <div class="supplier-certifications">
                        ${supplier.certifications.map(c => `<span class="cert-badge">‚úì ${c}</span>`).join('')}
                    </div>
                </div>
            `).join('');
            }

            renderPagination();
            
            // Update favorite and note buttons after rendering
            setTimeout(() => {
                updateFavoriteButtons();
                updateNoteButtons();
            }, 0);
                console.log('‚úÖ Results rendered with', pageSuppliers.length, 'suppliers');
            } catch (error) {
                console.error('‚ùå Error rendering results:', error);
            }
        }

        // Pagination
        function renderPagination() {
            const totalPages = Math.ceil(filteredSuppliers.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            
            let html = `
                <button class="page-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>‚Üê Previous</button>
            `;

            const maxButtons = 7;
            let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxButtons - 1);

            if (endPage - startPage < maxButtons - 1) {
                startPage = Math.max(1, endPage - maxButtons + 1);
            }

            if (startPage > 1) {
                html += `<button class="page-btn" onclick="changePage(1)">1</button>`;
                if (startPage > 2) html += `<span>...</span>`;
            }

            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += `<span>...</span>`;
                html += `<button class="page-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
            }

            html += `
                <button class="page-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next ‚Üí</button>
            `;

            pagination.innerHTML = html;
        }

        function changePage(page) {
            const totalPages = Math.ceil(filteredSuppliers.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderResults();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Autocomplete
        const searchInput = document.getElementById('searchInput');
        const autocomplete = document.getElementById('autocomplete');
        const clearSearch = document.getElementById('clearSearch');

        searchInput.addEventListener('input', function() {
            const value = this.value.toLowerCase();
            clearSearch.style.display = value ? 'block' : 'none';

            if (value.length < 2) {
                autocomplete.classList.remove('active');
                applyFilters();
                return;
            }

            const suggestions = [];
            
            // Search suppliers
            allSuppliers.forEach(s => {
                if (s.name.toLowerCase().includes(value)) {
                    suggestions.push({ type: 'supplier', text: s.name, category: s.category });
                }
            });

            // Search products
            Object.values(productCategories).flat().forEach(p => {
                if (p.toLowerCase().includes(value) && !suggestions.find(s => s.text === p)) {
                    suggestions.push({ type: 'product', text: p, category: 'Product' });
                }
            });

            if (suggestions.length > 0) {
                autocomplete.innerHTML = suggestions.slice(0, 8).map(s => `
                    <div class="autocomplete-item" onclick="selectSuggestion('${s.text.replace(/'/g, "\\'")}')">
                        <span class="icon">${s.type === 'supplier' ? 'üè¢' : 'üì¶'}</span>
                        <span class="text">${s.text}</span>
                        <span class="category">${s.category}</span>
                    </div>
                `).join('');
                autocomplete.classList.add('active');
            } else {
                autocomplete.classList.remove('active');
            }

            applyFilters();
        });

        function selectSuggestion(text) {
            searchInput.value = text;
            autocomplete.classList.remove('active');
            applyFilters();
        }

        clearSearch.addEventListener('click', function() {
            searchInput.value = '';
            clearSearch.style.display = 'none';
            autocomplete.classList.remove('active');
            applyFilters();
        });

        // Sort
        document.getElementById('sortSelect').addEventListener('change', function() {
            const sortBy = this.value;
            
            switch(sortBy) {
                case 'score-high':
                    filteredSuppliers.sort((a, b) => b.aiScore - a.aiScore);
                    break;
                case 'score-low':
                    filteredSuppliers.sort((a, b) => a.aiScore - b.aiScore);
                    break;
                case 'name-asc':
                    filteredSuppliers.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'name-desc':
                    filteredSuppliers.sort((a, b) => b.name.localeCompare(a.name));
                    break;
                case 'rating':
                    filteredSuppliers.sort((a, b) => b.rating - a.rating);
                    break;
            }
            
            renderResults();
        });

        // Supplier Modal
        function openSupplierModal(supplierId) {
            const supplier = allSuppliers.find(s => s.id === supplierId);
            if (!supplier) {
                console.error('Supplier not found:', supplierId);
                return;
            }

            console.log('Opening modal for:', supplier.name, supplier);

            document.getElementById('modalTitle').textContent = supplier.name;
            document.getElementById('modalSubtitle').textContent = supplier.category;

            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div class="modal-section">
                    <h3>üìã About</h3>
                    <p class="description-text">${supplier.description}</p>
                    ${supplier.verified ? '<div style="margin-top: 15px;"><span class="walmart-verified">‚úì Verified Supplier</span></div>' : ''}
                </div>

                <div class="modal-section">
                    <h3>üìä Key Metrics</h3>
                    <div class="stat-cards">
                        <div class="stat-card">
                            <div class="value">‚≠ê ${supplier.rating}</div>
                            <div class="label">Rating (${supplier.reviews} reviews)</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">${supplier.leadTime}</div>
                            <div class="label">Lead Time</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">${supplier.responseTime}</div>
                            <div class="label">Response Time</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">${supplier.contractTerms}</div>
                            <div class="label">Contract Terms</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">${supplier.stockLevel.toLocaleString()}</div>
                            <div class="label">Stock Level</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">${supplier.minimumOrder}</div>
                            <div class="label">Min Order</div>
                        </div>
                    </div>
                </div>

                <div class="modal-section">
                    <h3>üè¢ Company Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Location</div>
                            <div class="info-value">üìç ${supplier.location}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Stock Status</div>
                            <div class="info-value">${supplier.inStock ? '‚úÖ In Stock' : '‚ùå Out of Stock'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ID</div>
                            <div class="info-value">${supplier.id}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Category</div>
                            <div class="info-value">${supplier.category}</div>
                        </div>
                    </div>
                </div>

                <div class="modal-section">
                    <h3>üì¶ Products & Services</h3>
                    <div class="product-tags">
                        ${supplier.products.map(p => `<span class="tag" style="cursor: pointer;">${p}</span>`).join('')}
                    </div>
                </div>

                <div class="modal-section">
                    <h3>‚úÖ Certifications</h3>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        ${supplier.certifications && supplier.certifications.length > 0 ? supplier.certifications.map(c => `<span class="cert-badge">‚úì ${c}</span>`).join('') : '<p style="color: #666;">No certifications listed</p>'}
                    </div>
                </div>

                <div class="modal-section">
                    <h3>‚öôÔ∏è Additional Details</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Last Updated</div>
                            <div class="info-value">${new Date(supplier.lastUpdated).toLocaleDateString()}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Last Stock Check</div>
                            <div class="info-value">${new Date(supplier.lastStockCheck).toLocaleDateString()}</div>
                        </div>
                    </div>
                </div>
            `;

            try {
                document.getElementById('supplierModal').classList.add('active');
                document.body.style.overflow = 'hidden';
                console.log('‚úÖ Modal opened for:', supplier.name);
            } catch (error) {
                console.error('‚ùå Error opening modal:', error);
            }
        }

        function closeModal() {
            document.getElementById('supplierModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        // Modal close handlers
        document.getElementById('modalClose').addEventListener('click', closeModal);
        document.getElementById('supplierModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeModal();
        });

        // Toggle fixture category
        function toggleFixtureCategory(categoryId) {
            const element = document.getElementById(categoryId);
            const icon = document.getElementById('icon-' + categoryId);
            if (element.classList.contains('collapsed')) {
                element.classList.remove('collapsed');
                icon.textContent = '‚ñº';
            } else {
                element.classList.add('collapsed');
                icon.textContent = '‚ñ∂';
            }
        }

        // Toggle category show more/less
        let categoriesExpanded = false;
        function toggleCategories() {
            const hiddenCategories = document.querySelectorAll('.hidden-category');
            const toggleButton = document.getElementById('categoryToggle');
            const toggleIcon = document.getElementById('categoryToggleIcon');
            
            categoriesExpanded = !categoriesExpanded;
            
            hiddenCategories.forEach(cat => {
                if (categoriesExpanded) {
                    cat.classList.add('show');
                } else {
                    cat.classList.remove('show');
                }
            });
            
            if (categoriesExpanded) {
                const hiddenCount = hiddenCategories.length;
                toggleButton.innerHTML = `<span id="categoryToggleIcon">‚ñ≤</span> Show Less`;
            } else {
                const hiddenCount = hiddenCategories.length;
                toggleButton.innerHTML = `<span id="categoryToggleIcon">‚ñº</span> Show More (${hiddenCount} more)`;
            }
        }

        // Update stats dashboard
        function updateStats() {
            try {
                document.getElementById('totalSuppliersCount').textContent = allSuppliers.length.toLocaleString();
                
                // Handle productCategories safely - it might not be fully initialized yet
                const catCount = (productCategories && Object.keys(productCategories).length) || 0;
                document.getElementById('categoriesCount').textContent = catCount;
                
                const prodCount = (productCategories && Object.values(productCategories).flat().length) || 0;
                document.getElementById('productsCount').textContent = prodCount.toLocaleString();
                
                document.getElementById('verifiedCount').textContent = allSuppliers.filter(s => s.walmartVerified).length.toLocaleString();
            } catch (error) {
                console.warn('‚ö†Ô∏è Error in updateStats:', error);
                // Set safe defaults
                document.getElementById('totalSuppliersCount').textContent = allSuppliers.length.toLocaleString();
                document.getElementById('categoriesCount').textContent = '0';
                document.getElementById('productsCount').textContent = '0';
                document.getElementById('verifiedCount').textContent = '0';
            }
        }

        // ==========================================
        // USER AUTHENTICATION & FAVORITES SYSTEM
        // ==========================================
        
        let currentUser = null;
        let userData = null;

        async function checkUserSession() {
            // Try to initialize SharePoint
            const spStatusElem = document.getElementById('spStatus');
            try {
                // Add a timeout wrapper - if init takes too long, fall back to local mode
                const initTimeout = new Promise((resolve) => {
                    setTimeout(() => {
                        console.warn('SharePoint init timeout - falling back to local mode');
                        resolve(false);
                    }, 7000); // 7 second overall timeout
                });
                
                // Only try SharePoint if service is initialized and enabled
                if (spService && SHAREPOINT_CONFIG.enabled) {
                    useSharePoint = await Promise.race([spService.init(), initTimeout]);
                } else {
                    useSharePoint = false;
                    console.log('‚ö†Ô∏è SharePoint not initialized or disabled');
                }
                
                if (useSharePoint) {
                    console.log('‚úÖ SharePoint connected! Using cloud storage.');
                    if (spStatusElem) spStatusElem.innerHTML = '‚òÅÔ∏è Cloud Mode';
                } else {
                    console.log('‚ö†Ô∏è SharePoint unavailable. Using localStorage fallback.');
                    if (spStatusElem) spStatusElem.innerHTML = 'üíæ Local Mode';
                }
            } catch (error) {
                console.warn('SharePoint init error:', error);
                useSharePoint = false;
                if (spStatusElem) spStatusElem.innerHTML = 'üíæ Local Mode';
            }

            // Get current user email
            let userEmail = localStorage.getItem('currentUser');
            
            // If using SharePoint and no localStorage user, try to get from SharePoint
            if (!userEmail && useSharePoint && spService.currentUserEmail) {
                userEmail = spService.currentUserEmail;
                localStorage.setItem('currentUser', userEmail);
            }
            
            // PUBLIC DASHBOARD: Set default guest user if not logged in
            // This is a public supplier portal, so we allow guest access
            if (!userEmail) {
                userEmail = 'guest@supplier-portal.local';
                localStorage.setItem('currentUser', userEmail);
                console.log('üåê Public portal mode - using guest user');
            }

            currentUser = userEmail;
            console.log('Current user:', currentUser);
            
            // Try to load user data from storage, but don't require it for public access
            try {
                userData = await storage.getUser(userEmail);
                if (!userData) {
                    // Create default guest user data
                    userData = {
                        email: userEmail,
                        name: 'Guest User',
                        role: 'viewer',
                        favorites: [],
                        preferences: {}
                    };
                    console.log('‚úÖ Using default guest user data');
                }
            } catch (error) {
                console.log('‚ÑπÔ∏è Using default guest user data (no storage available)');
                userData = {
                    email: userEmail,
                    name: 'Guest User',
                    role: 'viewer',
                    favorites: [],
                    preferences: {}
                };
            }

            // Update UI with user name
            document.getElementById('userName').textContent = `üë§ ${userData.name.split(' ')[0]}`;
            await updateFavoriteCount();
            await updateFavoriteButtons();
            await updateNoteButtons();

            return true;
        }

        function toggleUserDropdown(event) {
            event.stopPropagation();
            
            // Check if dropdown already exists
            let overlay = document.getElementById('userDropdownOverlay');
            let dropdown = document.querySelector('.user-dropdown');
            
            if (overlay && dropdown) {
                // Close it
                overlay.remove();
                dropdown.remove();
            } else {
                // Get button position
                const button = event.currentTarget;
                const rect = button.getBoundingClientRect();
                
                // Create overlay
                const overlayDiv = document.createElement('div');
                overlayDiv.id = 'userDropdownOverlay';
                overlayDiv.className = 'user-dropdown-overlay active';
                overlayDiv.onclick = function() {
                    overlayDiv.remove();
                    const dd = document.querySelector('.user-dropdown');
                    if (dd) dd.remove();
                };
                
                // Create dropdown positioned directly under button
                const dropdownDiv = document.createElement('div');
                dropdownDiv.className = 'user-dropdown';
                dropdownDiv.style.top = (rect.bottom + 10) + 'px';
                dropdownDiv.style.right = (window.innerWidth - rect.right) + 'px';
                dropdownDiv.innerHTML = `
                    <div class="dropdown-item" onclick="window.location.href='inbox.html'">Inbox</div>
                    <div class="dropdown-item" onclick="window.location.href='my-favorites.html'">My Favorites (<span id="favCountDrop">${userData?.favorites?.length || 0}</span>)</div>
                    <div class="dropdown-item" onclick="window.location.href='my-notes.html'">My Notes</div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item" onclick="logout()">Logout</div>
                `;
                
                document.body.appendChild(overlayDiv);
                document.body.appendChild(dropdownDiv);
            }
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        }

        async function toggleFavorite(supplierId) {
            console.log('toggleFavorite called for:', supplierId);
            
            if (!userData) {
                console.warn('userData not initialized, creating it now');
                userData = { favorites: [], notes: {}, preferences: {} };
            }

            if (!userData.favorites) userData.favorites = [];
            if (!Array.isArray(userData.favorites)) userData.favorites = [];

            try {
                const index = userData.favorites.indexOf(supplierId);
                if (index > -1) {
                    // Remove favorite
                    userData.favorites.splice(index, 1);
                    console.log('‚úÖ Removed from favorites:', supplierId);
                } else {
                    // Add favorite
                    userData.favorites.push(supplierId);
                    console.log('‚úÖ Added to favorites:', supplierId);
                }

                // Save to storage
                await updateFavoriteButtons();
                await updateFavoriteCount();
                showNotification('‚ù§Ô∏è Favorite updated!');
            } catch (error) {
                console.error('‚ùå Error toggling favorite:', error);
                showNotification('‚ö†Ô∏è Error updating favorite');
            }
        }

        function updateFavoriteButtons() {
            if (!userData || !userData.favorites) return;

            document.querySelectorAll('.favorite-btn').forEach(btn => {
                const supplierId = parseInt(btn.id.replace('fav-', ''));
                if (userData.favorites.includes(supplierId)) {
                    btn.classList.add('favorited');
                } else {
                    btn.classList.remove('favorited');
                }
            });
        }

        function updateFavoriteCount() {
            if (!userData || !userData.favorites) return;
            const favCountElem = document.getElementById('favCount');
            if (favCountElem) favCountElem.textContent = userData.favorites.length;
            const favCountDrop = document.getElementById('favCountDrop');
            if (favCountDrop) favCountDrop.textContent = userData.favorites.length;
        }

        function showMyFavorites() {
            if (!userData || !userData.favorites || userData.favorites.length === 0) {
                showNotification('‚ù§Ô∏è No favorites yet! Click the heart icon on suppliers to save them.');
                return;
            }

            // Filter to show only favorites
            filteredSuppliers = allSuppliers.filter(s => userData.favorites.includes(s.id));
            currentPage = 1;
            renderResults();

            showNotification(`‚ù§Ô∏è Showing ${filteredSuppliers.length} favorite suppliers`);
            document.getElementById('userDropdown').classList.remove('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function openNoteModal(supplierId) {
            try {
                console.log('openNoteModal called for:', supplierId);
                
                if (!userData) {
                    console.warn('userData not initialized, creating it');
                    userData = { favorites: [], notes: {}, preferences: {} };
                }
                
                if (!userData.notes) userData.notes = {};
                
                const supplier = allSuppliers.find(s => s.id === supplierId);
                if (!supplier) {
                    console.error('Supplier not found:', supplierId);
                    return;
                }

                const currentNote = (userData.notes && userData.notes[supplierId]) || '';

                const modalHTML = `
                    <div class="note-modal" id="noteModal">
                        <div class="note-modal-content">
                            <div class="note-modal-header">
                                <h2 style="font-family: var(--heading-font); font-size: 1.5rem; letter-spacing: 1px;">üìù NOTES: ${supplier.name}</h2>
                                <button onclick="closeNoteModal()" class="modal-close">‚úï</button>
                            </div>
                            <div class="note-modal-body">
                                <textarea id="noteTextarea" placeholder="Add your notes about this supplier..." style="width: 100%; height: 200px; padding: 15px; font-family: var(--body-font); font-size: 1rem; border: 2px solid #ddd; resize: vertical;">${currentNote}</textarea>
                                <div style="margin-top: 15px; display: flex; gap: 10px;">
                                    <button onclick="saveNote(${supplierId})" class="btn btn-primary" style="flex: 1; padding: 12px;">üíæ SAVE NOTE</button>
                                    <button onclick="deleteNote(${supplierId})" class="btn btn-secondary" style="padding: 12px;">üóëÔ∏è DELETE</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                document.body.insertAdjacentHTML('beforeend', modalHTML);
                console.log('‚úÖ Note modal opened for:', supplierId);
            } catch (error) {
                console.error('‚ùå Error opening note modal:', error);
                showNotification('‚ö†Ô∏è Error opening notes');
            }
        }

        function closeNoteModal() {
            const modal = document.getElementById('noteModal');
            if (modal) modal.remove();
        }

        async function saveNote(supplierId) {
            try {
                console.log('saveNote called for:', supplierId);
                const noteTextarea = document.getElementById('noteTextarea');
                if (!noteTextarea) {
                    console.error('Textarea not found');
                    return;
                }
                
                const noteText = noteTextarea.value.trim();
                
                if (!userData) userData = { favorites: [], notes: {}, preferences: {} };
                if (!userData.notes) userData.notes = {};

                if (noteText) {
                    userData.notes[supplierId] = noteText;
                    console.log('‚úÖ Note saved for:', supplierId);
                    showNotification('‚úÖ Note saved successfully!');
                } else {
                    delete userData.notes[supplierId];
                    console.log('‚úÖ Note cleared for:', supplierId);
                    showNotification('üóëÔ∏è Note cleared');
                }

                await updateNoteButtons();
                closeNoteModal();
            } catch (error) {
                console.error('‚ùå Error saving note:', error);
                showNotification('‚ö†Ô∏è Error saving note');
            }
        }

        async function deleteNote(supplierId) {
            try {
                console.log('deleteNote called for:', supplierId);
                
                if (!userData) userData = { favorites: [], notes: {}, preferences: {} };
                if (!userData.notes) userData.notes = {};
                
                if (userData.notes[supplierId]) {
                    delete userData.notes[supplierId];
                    console.log('‚úÖ Note deleted for:', supplierId);
                    await updateNoteButtons();
                    showNotification('üóëÔ∏è Note deleted');
                }

                closeNoteModal();
            } catch (error) {
                console.error('‚ùå Error deleting note:', error);
                showNotification('‚ö†Ô∏è Error deleting note');
            }
        }

        function updateNoteButtons() {
            if (!userData || !userData.notes) return;

            document.querySelectorAll('.note-btn').forEach(btn => {
                const supplierId = parseInt(btn.getAttribute('onclick').match(/\d+/)[0]);
                if (userData.notes[supplierId]) {
                    btn.classList.add('has-note');
                } else {
                    btn.classList.remove('has-note');
                }
            });
        }

        function showMyNotes() {
            if (!userData || !userData.notes || Object.keys(userData.notes).length === 0) {
                showNotification('üìù No notes yet! Click the note icon on suppliers to add notes.');
                return;
            }

            const supplierIds = Object.keys(userData.notes).map(id => parseInt(id));
            filteredSuppliers = allSuppliers.filter(s => supplierIds.includes(s.id));
            currentPage = 1;
            renderResults();

            showNotification(`üìù Showing ${filteredSuppliers.length} suppliers with notes`);
            document.getElementById('userDropdown').classList.remove('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Add CSS for note modal
        const noteModalStyle = document.createElement('style');
        noteModalStyle.textContent = `
            .note-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }
            .note-modal-content {
                background: white;
                width: 100%;
                max-width: 600px;
                border: 4px solid var(--walmart-blue);
                box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.3);
            }
            .note-modal-header {
                background: var(--walmart-blue);
                color: white;
                padding: 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 4px solid var(--walmart-yellow);
            }
            .note-modal-body {
                padding: 30px;
            }
        `;
        document.head.appendChild(noteModalStyle);

        // Initialize user session and determine cloud vs local mode
        checkUserSession().catch(err => {
            console.warn('User session check failed:', err);
            // Fall back to local mode if something goes wrong
            document.getElementById('spStatus').innerHTML = 'üíæ Local Mode';
        });
        
        // DEPRECATED: Old initialization calls - no longer needed
        // initializeFromServer() already handles everything above
        // Commenting out to prevent conflicting initialization
        
        // window.addEventListener('load', () => {
        //     console.log('üöÄ Dashboard initializing...');
        //     initializeDashboard();
        // });
        
        // if (document.readyState === 'loading') {
        //     document.addEventListener('DOMContentLoaded', initializeDashboard);
        // } else {
        //     setTimeout(initializeDashboard, 500);
        // }
        
        console.log('‚úÖ Dashboard ready - suppliers loaded from API');
    </script>
</body>
</html>